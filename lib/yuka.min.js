/*

 The MIT License

 Copyright Â© 2021 Yuka authors

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(h){var q=0;return function(){return q<h.length?{done:!1,value:h[q++]}:{done:!0}}};$jscomp.arrayIterator=function(h){return{next:$jscomp.arrayIteratorImpl(h)}};$jscomp.makeIterator=function(h){var q="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];return q?q.call(h):$jscomp.arrayIterator(h)};$jscomp.arrayFromIterator=function(h){for(var q,p=[];!(q=h.next()).done;)p.push(q.value);return p};
$jscomp.arrayFromIterable=function(h){return h instanceof Array?h:$jscomp.arrayFromIterator($jscomp.makeIterator(h))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(h){var q=function(){};q.prototype=h;return new q};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,q,p){if(h==Array.prototype||h==Object.prototype)return h;h[q]=p.value;return h};$jscomp.getGlobal=function(h){h=["object"==typeof globalThis&&globalThis,h,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var q=0;q<h.length;++q){var p=h[q];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(h,q){var p=$jscomp.propertyToPolyfillSymbol[q];if(null==p)return h[q];p=h[p];return void 0!==p?p:h[q]};
$jscomp.polyfill=function(h,q,p,v){q&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(h,q,p,v):$jscomp.polyfillUnisolated(h,q,p,v))};$jscomp.polyfillUnisolated=function(h,q,p,v){p=$jscomp.global;h=h.split(".");for(v=0;v<h.length-1;v++){var u=h[v];if(!(u in p))return;p=p[u]}h=h[h.length-1];v=p[h];q=q(v);q!=v&&null!=q&&$jscomp.defineProperty(p,h,{configurable:!0,writable:!0,value:q})};
$jscomp.polyfillIsolated=function(h,q,p,v){var u=h.split(".");h=1===u.length;v=u[0];v=!h&&v in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var K=0;K<u.length-1;K++){var t=u[K];if(!(t in v))return;v=v[t]}u=u[u.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?v[u]:null;q=q(p);null!=q&&(h?$jscomp.defineProperty($jscomp.polyfills,u,{configurable:!0,writable:!0,value:q}):q!==p&&($jscomp.propertyToPolyfillSymbol[u]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(u):$jscomp.POLYFILL_PREFIX+u,u=
$jscomp.propertyToPolyfillSymbol[u],$jscomp.defineProperty(v,u,{configurable:!0,writable:!0,value:q})))};
$jscomp.getConstructImplementation=function(){function h(){function p(){}new p;Reflect.construct(p,[],function(){});return new p instanceof p}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(h())return Reflect.construct;var q=Reflect.construct;return function(p,v,u){p=q(p,v);u&&Reflect.setPrototypeOf(p,u.prototype);return p}}return function(p,v,u){void 0===u&&(u=p);u=$jscomp.objectCreate(u.prototype||Object.prototype);return Function.prototype.apply.call(p,u,v)||
u}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var h={a:!0},q={};try{return q.__proto__=h,q.a}catch(p){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(h,q){h.__proto__=q;if(h.__proto__!==q)throw new TypeError(h+" is not extensible");return h}:null;
$jscomp.inherits=function(h,q){h.prototype=$jscomp.objectCreate(q.prototype);h.prototype.constructor=h;if($jscomp.setPrototypeOf){var p=$jscomp.setPrototypeOf;p(h,q)}else for(p in q)if("prototype"!=p)if(Object.defineProperties){var v=Object.getOwnPropertyDescriptor(q,p);v&&Object.defineProperty(h,p,v)}else h[p]=q[p];h.superClass_=q.prototype};$jscomp.polyfill("Reflect",function(h){return h?h:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(h){return $jscomp.construct},"es6","es3");
$jscomp.polyfill("Reflect.setPrototypeOf",function(h){if(h)return h;if($jscomp.setPrototypeOf){var q=$jscomp.setPrototypeOf;return function(p,v){try{return q(p,v),!0}catch(u){return!1}}}return null},"es6","es5");$jscomp.findInternal=function(h,q,p){h instanceof String&&(h=String(h));for(var v=h.length,u=0;u<v;u++){var K=h[u];if(q.call(p,K,u,h))return{i:u,v:K}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(h){return h?h:function(q,p){return $jscomp.findInternal(this,q,p).i}},"es6","es3");$jscomp.polyfill("Number.EPSILON",function(h){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Math.sign",function(h){return h?h:function(q){q=Number(q);return 0===q||isNaN(q)?q:0<q?1:-1}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var h={},q=Object.create(new $jscomp.global.Proxy(h,{get:function(p,v,u){return p==h&&"q"==v&&u==q}}));return!0===q.q}catch(p){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(h){if(h)return h;var q=function(u,K){this.$jscomp$symbol$id_=u;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:K})};q.prototype.toString=function(){return this.$jscomp$symbol$id_};var p=0,v=function(u){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new q("jscomp_symbol_"+(u||"")+"_"+p++,u)};return v},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(h){if(h)return h;h=Symbol("Symbol.iterator");for(var q="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),p=0;p<q.length;p++){var v=$jscomp.global[q[p]];"function"===typeof v&&"function"!=typeof v.prototype[h]&&$jscomp.defineProperty(v.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return h},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(h){h={next:h};h[Symbol.iterator]=function(){return this};return h};$jscomp.owns=function(h,q){return Object.prototype.hasOwnProperty.call(h,q)};
$jscomp.polyfill("WeakMap",function(h){function q(){if(!h||!Object.seal)return!1;try{var x=Object.seal({}),y=Object.seal({}),H=new h([[x,2],[y,3]]);if(2!=H.get(x)||3!=H.get(y))return!1;H.delete(x);H.set(y,4);return!H.has(x)&&4==H.get(y)}catch(E){return!1}}function p(){}function v(x){var y=typeof x;return"object"===y&&null!==x||"function"===y}function u(x){if(!$jscomp.owns(x,t)){var y=new p;$jscomp.defineProperty(x,t,{value:y})}}function K(x){if(!$jscomp.ISOLATE_POLYFILLS){var y=Object[x];y&&(Object[x]=
function(H){if(H instanceof p)return H;Object.isExtensible(H)&&u(H);return y(H)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(q())return h;var t="$jscomp_hidden_"+Math.random();K("freeze");K("preventExtensions");K("seal");var B=0,w=function(x){this.id_=(B+=Math.random()+1).toString();if(x){x=$jscomp.makeIterator(x);for(var y;!(y=x.next()).done;)y=y.value,this.set(y[0],y[1])}};w.prototype.set=function(x,y){if(!v(x))throw Error("Invalid WeakMap key");
u(x);if(!$jscomp.owns(x,t))throw Error("WeakMap key fail: "+x);x[t][this.id_]=y;return this};w.prototype.get=function(x){return v(x)&&$jscomp.owns(x,t)?x[t][this.id_]:void 0};w.prototype.has=function(x){return v(x)&&$jscomp.owns(x,t)&&$jscomp.owns(x[t],this.id_)};w.prototype.delete=function(x){return v(x)&&$jscomp.owns(x,t)&&$jscomp.owns(x[t],this.id_)?delete x[t][this.id_]:!1};return w},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(h){function q(){if($jscomp.ASSUME_NO_NATIVE_MAP||!h||"function"!=typeof h||!h.prototype.entries||"function"!=typeof Object.seal)return!1;try{var w=Object.seal({x:4}),x=new h($jscomp.makeIterator([[w,"s"]]));if("s"!=x.get(w)||1!=x.size||x.get({x:4})||x.set({x:4},"t")!=x||2!=x.size)return!1;var y=x.entries(),H=y.next();if(H.done||H.value[0]!=w||"s"!=H.value[1])return!1;H=y.next();return H.done||4!=H.value[0].x||"t"!=H.value[1]||!y.next().done?!1:!0}catch(E){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(q())return h;var p=new WeakMap,v=function(w){this.data_={};this.head_=t();this.size=0;if(w){w=$jscomp.makeIterator(w);for(var x;!(x=w.next()).done;)x=x.value,this.set(x[0],x[1])}};v.prototype.set=function(w,x){w=0===w?0:w;var y=u(this,w);y.list||(y.list=this.data_[y.id]=[]);y.entry?y.entry.value=x:(y.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:w,value:x},y.list.push(y.entry),
this.head_.previous.next=y.entry,this.head_.previous=y.entry,this.size++);return this};v.prototype.delete=function(w){w=u(this,w);return w.entry&&w.list?(w.list.splice(w.index,1),w.list.length||delete this.data_[w.id],w.entry.previous.next=w.entry.next,w.entry.next.previous=w.entry.previous,w.entry.head=null,this.size--,!0):!1};v.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=t();this.size=0};v.prototype.has=function(w){return!!u(this,w).entry};v.prototype.get=function(w){return(w=
u(this,w).entry)&&w.value};v.prototype.entries=function(){return K(this,function(w){return[w.key,w.value]})};v.prototype.keys=function(){return K(this,function(w){return w.key})};v.prototype.values=function(){return K(this,function(w){return w.value})};v.prototype.forEach=function(w,x){for(var y=this.entries(),H;!(H=y.next()).done;)H=H.value,w.call(x,H[1],H[0],this)};v.prototype[Symbol.iterator]=v.prototype.entries;var u=function(w,x){var y=x&&typeof x;"object"==y||"function"==y?p.has(x)?y=p.get(x):
(y=""+ ++B,p.set(x,y)):y="p_"+x;var H=w.data_[y];if(H&&$jscomp.owns(w.data_,y))for(w=0;w<H.length;w++){var E=H[w];if(x!==x&&E.key!==E.key||x===E.key)return{id:y,list:H,index:w,entry:E}}return{id:y,list:H,index:-1,entry:void 0}},K=function(w,x){var y=w.head_;return $jscomp.iteratorPrototype(function(){if(y){for(;y.head!=w.head_;)y=y.previous;for(;y.next!=y.head;)return y=y.next,{done:!1,value:x(y)};y=null}return{done:!0,value:void 0}})},t=function(){var w={};return w.previous=w.next=w.head=w},B=0;
return v},"es6","es3");$jscomp.iteratorFromArray=function(h,q){h instanceof String&&(h+="");var p=0,v=!1,u={next:function(){if(!v&&p<h.length){var K=p++;return{value:q(K,h[K]),done:!1}}v=!0;return{done:!0,value:void 0}}};u[Symbol.iterator]=function(){return u};return u};$jscomp.polyfill("Array.prototype.values",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(q,p){return p})}},"es8","es3");
$jscomp.polyfill("Array.from",function(h){return h?h:function(q,p,v){p=null!=p?p:function(B){return B};var u=[],K="undefined"!=typeof Symbol&&Symbol.iterator&&q[Symbol.iterator];if("function"==typeof K){q=K.call(q);for(var t=0;!(K=q.next()).done;)u.push(p.call(v,K.value,t++))}else for(K=q.length,t=0;t<K;t++)u.push(p.call(v,q[t],t));return u}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(q,p){return[q,p]})}},"es6","es3");
$jscomp.polyfill("Set",function(h){function q(){if($jscomp.ASSUME_NO_NATIVE_SET||!h||"function"!=typeof h||!h.prototype.entries||"function"!=typeof Object.seal)return!1;try{var v=Object.seal({x:4}),u=new h($jscomp.makeIterator([v]));if(!u.has(v)||1!=u.size||u.add(v)!=u||1!=u.size||u.add({x:4})!=u||2!=u.size)return!1;var K=u.entries(),t=K.next();if(t.done||t.value[0]!=v||t.value[1]!=v)return!1;t=K.next();return t.done||t.value[0]==v||4!=t.value[0].x||t.value[1]!=t.value[0]?!1:K.next().done}catch(B){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(q())return h;var p=function(v){this.map_=new Map;if(v){v=$jscomp.makeIterator(v);for(var u;!(u=v.next()).done;)this.add(u.value)}this.size=this.map_.size};p.prototype.add=function(v){v=0===v?0:v;this.map_.set(v,v);this.size=this.map_.size;return this};p.prototype.delete=function(v){v=this.map_.delete(v);this.size=this.map_.size;return v};p.prototype.clear=function(){this.map_.clear();this.size=0};p.prototype.has=
function(v){return this.map_.has(v)};p.prototype.entries=function(){return this.map_.entries()};p.prototype.values=function(){return this.map_.values()};p.prototype.keys=p.prototype.values;p.prototype[Symbol.iterator]=p.prototype.values;p.prototype.forEach=function(v,u){var K=this;this.map_.forEach(function(t){return v.call(u,t,t,K)})};return p},"es6","es3");$jscomp.polyfill("Object.is",function(h){return h?h:function(q,p){return q===p?0!==q||1/q===1/p:q!==q&&p!==p}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(h){return h?h:function(q,p){var v=this;v instanceof String&&(v=String(v));var u=v.length;p=p||0;for(0>p&&(p=Math.max(p+u,0));p<u;p++){var K=v[p];if(K===q||Object.is(K,q))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(h,q,p){if(null==h)throw new TypeError("The 'this' value for String.prototype."+p+" must not be null or undefined");if(q instanceof RegExp)throw new TypeError("First argument to String.prototype."+p+" must not be a regular expression");return h+""};$jscomp.polyfill("String.prototype.includes",function(h){return h?h:function(q,p){return-1!==$jscomp.checkStringArgs(this,q,"includes").indexOf(q,p||0)}},"es6","es3");
$jscomp.polyfill("Promise",function(h){function q(){this.batch_=null}function p(t){return t instanceof u?t:new u(function(B,w){B(t)})}if(h&&!$jscomp.FORCE_POLYFILL_PROMISE)return h;q.prototype.asyncExecute=function(t){if(null==this.batch_){this.batch_=[];var B=this;this.asyncExecuteFunction(function(){B.executeBatch_()})}this.batch_.push(t)};var v=$jscomp.global.setTimeout;q.prototype.asyncExecuteFunction=function(t){v(t,0)};q.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var t=
this.batch_;this.batch_=[];for(var B=0;B<t.length;++B){var w=t[B];t[B]=null;try{w()}catch(x){this.asyncThrow_(x)}}}this.batch_=null};q.prototype.asyncThrow_=function(t){this.asyncExecuteFunction(function(){throw t;})};var u=function(t){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var B=this.createResolveAndReject_();try{t(B.resolve,B.reject)}catch(w){B.reject(w)}};u.prototype.createResolveAndReject_=function(){function t(x){return function(y){w||(w=!0,
x.call(B,y))}}var B=this,w=!1;return{resolve:t(this.resolveTo_),reject:t(this.reject_)}};u.prototype.resolveTo_=function(t){if(t===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof u)this.settleSameAsPromise_(t);else{a:switch(typeof t){case "object":var B=null!=t;break a;case "function":B=!0;break a;default:B=!1}B?this.resolveToNonPromiseObj_(t):this.fulfill_(t)}};u.prototype.resolveToNonPromiseObj_=function(t){var B=void 0;try{B=t.then}catch(w){this.reject_(w);
return}"function"==typeof B?this.settleSameAsThenable_(B,t):this.fulfill_(t)};u.prototype.reject_=function(t){this.settle_(2,t)};u.prototype.fulfill_=function(t){this.settle_(1,t)};u.prototype.settle_=function(t,B){if(0!=this.state_)throw Error("Cannot settle("+t+", "+B+"): Promise already settled in state"+this.state_);this.state_=t;this.result_=B;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};u.prototype.scheduleUnhandledRejectionCheck_=function(){var t=
this;v(function(){if(t.notifyUnhandledRejection_()){var B=$jscomp.global.console;"undefined"!==typeof B&&B.error(t.result_)}},1)};u.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var t=$jscomp.global.CustomEvent,B=$jscomp.global.Event,w=$jscomp.global.dispatchEvent;if("undefined"===typeof w)return!0;"function"===typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"===typeof B?t=new B("unhandledrejection",{cancelable:!0}):(t=$jscomp.global.document.createEvent("CustomEvent"),
t.initCustomEvent("unhandledrejection",!1,!0,t));t.promise=this;t.reason=this.result_;return w(t)};u.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var t=0;t<this.onSettledCallbacks_.length;++t)K.asyncExecute(this.onSettledCallbacks_[t]);this.onSettledCallbacks_=null}};var K=new q;u.prototype.settleSameAsPromise_=function(t){var B=this.createResolveAndReject_();t.callWhenSettled_(B.resolve,B.reject)};u.prototype.settleSameAsThenable_=function(t,B){var w=this.createResolveAndReject_();
try{t.call(B,w.resolve,w.reject)}catch(x){w.reject(x)}};u.prototype.then=function(t,B){function w(E,ya){return"function"==typeof E?function(ra){try{x(E(ra))}catch(ba){y(ba)}}:ya}var x,y,H=new u(function(E,ya){x=E;y=ya});this.callWhenSettled_(w(t,x),w(B,y));return H};u.prototype.catch=function(t){return this.then(void 0,t)};u.prototype.callWhenSettled_=function(t,B){function w(){switch(x.state_){case 1:t(x.result_);break;case 2:B(x.result_);break;default:throw Error("Unexpected state: "+x.state_);
}}var x=this;null==this.onSettledCallbacks_?K.asyncExecute(w):this.onSettledCallbacks_.push(w);this.isRejectionHandled_=!0};u.resolve=p;u.reject=function(t){return new u(function(B,w){w(t)})};u.race=function(t){return new u(function(B,w){for(var x=$jscomp.makeIterator(t),y=x.next();!y.done;y=x.next())p(y.value).callWhenSettled_(B,w)})};u.all=function(t){var B=$jscomp.makeIterator(t),w=B.next();return w.done?p([]):new u(function(x,y){function H(ra){return function(ba){E[ra]=ba;ya--;0==ya&&x(E)}}var E=
[],ya=0;do E.push(void 0),ya++,p(w.value).callWhenSettled_(H(E.length-1),y),w=B.next();while(!w.done)})};return u},"es6","es3");
(function(h,q){"object"===typeof exports&&"undefined"!==typeof module?q(exports):"function"===typeof define&&define.amd?define(["exports"],q):(h="undefined"!==typeof globalThis?globalThis:h||self,q(h.YUKA={}))})(this,function(h){function q(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c].uuid);return b}function p(){!1===document.hidden&&this.reset()}function v(a,b,c){return 1/Math.sqrt(2*Math.PI*c)*Math.exp(-Math.pow(a-b,2)/(2*c))}function u(a,b){return a<b?-1:a>b?1:0}function K(a,b){return a.cost<
b.cost?-1:a.cost>b.cost?1:0}function t(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function B(a,b){return a.p-b.p}function w(a,b){return a.cost<b.cost?1:a.cost>b.cost?-1:0}function x(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function y(a){for(var b=this.tasks;0<a.timeRemaining()&&0<b.length;)b[0].execute(),b.shift();0<b.length?(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):(this._taskHandle=
0,this._active=!1)}var H=function(a,b,c,d,e){this.sender=a;this.receiver=b;this.message=c;this.delay=d;this.data=e};H.prototype.toJSON=function(){return{type:this.constructor.name,sender:this.sender.uuid,receiver:this.receiver.uuid,message:this.message,delay:this.delay,data:this.data}};H.prototype.fromJSON=function(a){this.sender=a.sender;this.receiver=a.receiver;this.message=a.message;this.delay=a.delay;this.data=a.data;return this};H.prototype.resolveReferences=function(a){this.sender=a.get(this.sender);
this.receiver=a.get(this.receiver);return this};var E=function(){};E.setLevel=function(a){ya=a};E.log=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];ya<=E.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(b))};E.warn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];ya<=E.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(b))};E.error=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];ya<=E.LEVEL.ERROR&&
console.error.apply(console,$jscomp.arrayFromIterable(b))};E.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});var ya=E.LEVEL.WARN,ra=function(){this.delayedTelegrams=[]};ra.prototype.deliver=function(a){var b=a.receiver;!1===b.handleMessage(a)&&E.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",b);return this};ra.prototype.dispatch=function(a,b,c,d,e){a=new H(a,b,c,d,e);0>=d?this.deliver(a):this.delayedTelegrams.push(a);return this};ra.prototype.dispatchDelayedMessages=function(a){for(var b=
this.delayedTelegrams.length;b--;){var c=this.delayedTelegrams[b];c.delay-=a;0>=c.delay&&(this.deliver(c),this.delayedTelegrams.pop())}return this};ra.prototype.clear=function(){this.delayedTelegrams.length=0;return this};ra.prototype.toJSON=function(){for(var a={type:this.constructor.name,delayedTelegrams:[]},b=0,c=this.delayedTelegrams.length;b<c;b++)a.delayedTelegrams.push(this.delayedTelegrams[b].toJSON());return a};ra.prototype.fromJSON=function(a){this.clear();a=a.delayedTelegrams;for(var b=
0,c=a.length;b<c;b++){var d=a[b];d=(new H).fromJSON(d);this.delayedTelegrams.push(d)}return this};ra.prototype.resolveReferences=function(a){for(var b=this.delayedTelegrams,c=0,d=b.length;c<d;c++)b[c].resolveReferences(a);return this};for(var ba=[],Nb=0;256>Nb;Nb++)ba[Nb]=(16>Nb?"0":"")+Nb.toString(16);var T=function(){};T.area=function(a,b,c){return(c.x-a.x)*(b.z-a.z)-(b.x-a.x)*(c.z-a.z)};T.argmax=function(a){for(var b=Math.max.apply(Math,$jscomp.arrayFromIterable(a)),c=[],d=0,e=a.length;d<e;d++)a[d]===
b&&c.push(d);return c};T.choice=function(a,b){b=void 0===b?null:b;var c=Math.random();if(null===b)return a[Math.floor(Math.random()*a.length)];var d=0,e=a.map(function(f,g){return d+=b[g]}).findIndex(function(f){return f>=c});return a[e]};T.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};T.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(ba[a&255]+ba[a>>8&255]+ba[a>>16&255]+ba[a>>24&255]+
"-"+ba[b&255]+ba[b>>8&255]+"-"+ba[b>>16&15|64]+ba[b>>24&255]+"-"+ba[c&63|128]+ba[c>>8&255]+"-"+ba[c>>16&255]+ba[c>>24&255]+ba[d&255]+ba[d>>8&255]+ba[d>>16&255]+ba[d>>24&255]).toUpperCase()};T.randFloat=function(a,b){return a+Math.random()*(b-a)};T.randInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};var l=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};l.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};l.prototype.copy=function(a){this.x=
a.x;this.y=a.y;this.z=a.z;return this};l.prototype.clone=function(){return(new this.constructor).copy(this)};l.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};l.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};l.prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};l.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};l.prototype.subScalar=function(a){this.x-=a;this.y-=a;this.z-=a;return this};
l.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};l.prototype.multiply=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};l.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};l.prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};l.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};l.prototype.divideScalar=function(a){this.x/=a;this.y/=a;this.z/=
a;return this};l.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};l.prototype.reflect=function(a){return this.sub(Fe.copy(a).multiplyScalar(2*this.dot(a)))};l.prototype.clamp=function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this};l.prototype.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this};l.prototype.max=
function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this};l.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};l.prototype.cross=function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this};l.prototype.crossVectors=function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this};l.prototype.angleTo=function(a){var b=Math.sqrt(this.squaredLength()*
a.squaredLength());if(0===b)return 0;a=this.dot(a)/b;return Math.acos(T.clamp(a,-1,1))};l.prototype.length=function(){return Math.sqrt(this.squaredLength())};l.prototype.squaredLength=function(){return this.dot(this)};l.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};l.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};l.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a};
l.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)};l.prototype.normalize=function(){return this.divideScalar(this.length()||1)};l.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this};l.prototype.applyRotation=function(a){var b=this.x,c=this.y,d=
this.z,e=a.x,f=a.y,g=a.z;a=a.w;var k=a*b+f*d-g*c,m=a*c+g*b-e*d,n=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=k*a+b*-e+m*-g-n*-f;this.y=m*a+b*-f+n*-e-k*-g;this.z=n*a+b*-g+k*-f-m*-e;return this};l.prototype.extractPositionFromMatrix=function(a){a=a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this};l.prototype.transformDirection=function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()};l.prototype.fromMatrix3Column=
function(a,b){return this.fromArray(a.elements,3*b)};l.prototype.fromMatrix4Column=function(a,b){return this.fromArray(a.elements,4*b)};l.prototype.fromSpherical=function(a,b,c){var d=Math.sin(b)*a;this.x=d*Math.sin(c);this.y=Math.cos(b)*a;this.z=d*Math.cos(c);return this};l.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};l.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a};l.prototype.equals=
function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z};var Fe=new l,Uc=new l(0,1,0),Hd=new l,Ob=new l,Id=new l,Jd=new l,Vc=[2,2,1],Wc=[1,0,0],O=function(){this.elements=[1,0,0,0,1,0,0,0,1]};O.prototype.set=function(a,b,c,d,e,f,g,k,m){var n=this.elements;n[0]=a;n[3]=b;n[6]=c;n[1]=d;n[4]=e;n[7]=f;n[2]=g;n[5]=k;n[8]=m;return this};O.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};
O.prototype.clone=function(){return(new this.constructor).copy(this)};O.prototype.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};O.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};O.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};O.prototype.multiplyMatrices=function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[3],f=c[6],g=c[1],k=c[4],m=c[7],n=c[2],r=c[5];c=c[8];var z=d[0],D=d[3],J=d[6],F=d[1],G=d[4],C=d[7],M=d[2],sa=d[5];
d=d[8];b[0]=a*z+e*F+f*M;b[3]=a*D+e*G+f*sa;b[6]=a*J+e*C+f*d;b[1]=g*z+k*F+m*M;b[4]=g*D+k*G+m*sa;b[7]=g*J+k*C+m*d;b[2]=n*z+r*F+c*M;b[5]=n*D+r*G+c*sa;b[8]=n*J+r*C+c*d;return this};O.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this};O.prototype.extractBasis=function(a,b,c){a.fromMatrix3Column(this,0);b.fromMatrix3Column(this,1);c.fromMatrix3Column(this,2);return this};O.prototype.makeBasis=function(a,b,c){this.set(a.x,
b.x,c.x,a.y,b.y,c.y,a.z,b.z,c.z);return this};O.prototype.lookAt=function(a,b,c){Hd.crossVectors(c,a).normalize();Ob.crossVectors(Uc,b).normalize();0===Ob.squaredLength()&&(Jd.copy(b).addScalar(Number.EPSILON),Ob.crossVectors(Uc,Jd).normalize());Id.crossVectors(b,Ob).normalize();rb.makeBasis(Ob,Id,b);fc.makeBasis(Hd,c,a);this.multiplyMatrices(rb,fc.transpose());return this};O.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=
b;return this};O.prototype.getElementIndex=function(a,b){return 3*a+b};O.prototype.frobeniusNorm=function(){for(var a=this.elements,b=0,c=0;9>c;c++)b+=a[c]*a[c];return Math.sqrt(b)};O.prototype.offDiagonalFrobeniusNorm=function(){for(var a=this.elements,b=0,c=0;3>c;c++){var d=a[this.getElementIndex(Vc[c],Wc[c])];b+=2*d*d}return Math.sqrt(b)};O.prototype.eigenDecomposition=function(a){var b=0,c=0;a.unitary.identity();a.diagonal.copy(this);for(var d=a.unitary,e=a.diagonal,f=Number.EPSILON*e.frobeniusNorm();10>
c&&e.offDiagonalFrobeniusNorm()>f;)e.shurDecomposition(rb),fc.copy(rb).transpose(),e.multiply(rb),e.premultiply(fc),d.multiply(rb),2<++b&&(c++,b=0);return a};O.prototype.shurDecomposition=function(a){for(var b=0,c=1,d=this.elements,e=0;3>e;e++){var f=Math.abs(d[this.getElementIndex(Vc[e],Wc[e])]);f>b&&(b=f,c=e)}e=1;f=0;b=Wc[c];c=Vc[c];Math.abs(d[this.getElementIndex(c,b)])>Number.EPSILON&&(e=d[this.getElementIndex(c,c)],f=d[this.getElementIndex(b,b)],d=d[this.getElementIndex(c,b)],d=(e-f)/2/d,d=0>
d?-1/(-d+Math.sqrt(1+d*d)):1/(d+Math.sqrt(1+d*d)),e=1/Math.sqrt(1+d*d),f=d*e);a.identity();a.elements[this.getElementIndex(b,b)]=e;a.elements[this.getElementIndex(c,c)]=e;a.elements[this.getElementIndex(c,b)]=f;a.elements[this.getElementIndex(b,c)]=-f;return a};O.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,k=d+d,m=e+e;a=c*g;var n=c*k;c*=m;var r=d*k;d*=m;e*=m;g*=f;k*=f;f*=m;b[0]=1-(r+e);b[3]=n-f;b[6]=c+k;b[1]=n+f;b[4]=1-(a+e);b[7]=d-g;b[2]=c-k;b[5]=d+g;b[8]=
1-(a+r);return this};O.prototype.fromMatrix4=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return this};O.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,d=0;9>d;d++)c[d]=a[d+b];return this};O.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a};O.prototype.equals=
function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0};var rb=new O,fc=new O,gc=new O,Xc=new l,Q=function(a,b,c,d){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.w=void 0===d?1:d};Q.prototype.set=function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this};Q.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};Q.prototype.clone=function(){return(new this.constructor).copy(this)};Q.prototype.inverse=
function(){return this.conjugate().normalize()};Q.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};Q.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w};Q.prototype.length=function(){return Math.sqrt(this.squaredLength())};Q.prototype.squaredLength=function(){return this.dot(this)};Q.prototype.normalize=function(){var a=this.length();0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this};Q.prototype.multiply=
function(a){return this.multiplyQuaternions(this,a)};Q.prototype.premultiply=function(a){return this.multiplyQuaternions(a,this)};Q.prototype.multiplyQuaternions=function(a,b){var c=a.x,d=a.y,e=a.z;a=a.w;var f=b.x,g=b.y,k=b.z;b=b.w;this.x=c*b+a*f+d*k-e*g;this.y=d*b+a*g+e*f-c*k;this.z=e*b+a*k+c*g-d*f;this.w=a*b-c*f-d*g-e*k;return this};Q.prototype.angleTo=function(a){return 2*Math.acos(Math.abs(T.clamp(this.dot(a),-1,1)))};Q.prototype.rotateTo=function(a,b,c){c=void 0===c?1E-4:c;var d=this.angleTo(a);
if(d<c)return!0;this.slerp(a,Math.min(1,b/d));return!1};Q.prototype.lookAt=function(a,b,c){gc.lookAt(a,b,c);this.fromMatrix3(gc)};Q.prototype.slerp=function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this.x,d=this.y,e=this.z,f=this.w,g=f*a.w+c*a.x+d*a.y+e*a.z;0>g?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,g=-g):this.copy(a);if(1<=g)return this.w=f,this.x=c,this.y=d,this.z=e,this;a=Math.sqrt(1-g*g);if(.001>Math.abs(a))return this.w=.5*(f+this.w),this.x=.5*(c+this.x),this.y=
.5*(d+this.y),this.z=.5*(e+this.z),this;var k=Math.atan2(a,g);g=Math.sin((1-b)*k)/a;b=Math.sin(b*k)/a;this.w=f*g+this.w*b;this.x=c*g+this.x*b;this.y=d*g+this.y*b;this.z=e*g+this.z*b;return this};Q.prototype.extractRotationFromMatrix=function(a){var b=gc.elements,c=a.elements,d=1/Xc.fromMatrix4Column(a,0).length(),e=1/Xc.fromMatrix4Column(a,1).length();a=1/Xc.fromMatrix4Column(a,2).length();b[0]=c[0]*d;b[1]=c[1]*d;b[2]=c[2]*d;b[3]=c[4]*e;b[4]=c[5]*e;b[5]=c[6]*e;b[6]=c[8]*a;b[7]=c[9]*a;b[8]=c[10]*a;
this.fromMatrix3(gc);return this};Q.prototype.fromEuler=function(a,b,c){var d=Math.cos(b/2),e=Math.cos(a/2),f=Math.cos(c/2);b=Math.sin(b/2);a=Math.sin(a/2);c=Math.sin(c/2);this.w=d*e*f+b*a*c;this.x=d*a*f+b*e*c;this.y=b*e*f-d*a*c;this.z=d*e*c-b*a*f;return this};Q.prototype.toEuler=function(a){var b=-2*(this.y*this.z-this.x*this.w);.9999<Math.abs(b)?(a.x=.5*Math.PI*b,a.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),a.z=0):(a.x=Math.asin(b),a.y=Math.atan2(this.x*this.z+this.w*
this.y,.5-this.x*this.x-this.y*this.y),a.z=Math.atan2(this.x*this.y+this.w*this.z,.5-this.x*this.x-this.z*this.z));return a};Q.prototype.fromMatrix3=function(a){var b=a.elements,c=b[0];a=b[3];var d=b[6],e=b[1],f=b[4],g=b[7],k=b[2],m=b[5];b=b[8];var n=c+f+b;0<n?(c=.5/Math.sqrt(n+1),this.w=.25/c,this.x=(m-g)*c,this.y=(d-k)*c,this.z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this.w=(m-g)/c,this.x=.25*c,this.y=(a+e)/c,this.z=(d+k)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this.w=(d-k)/c,this.x=(a+e)/c,this.y=.25*
c,this.z=(g+m)/c):(c=2*Math.sqrt(1+b-c-f),this.w=(e-a)/c,this.x=(d+k)/c,this.y=(g+m)/c,this.z=.25*c);return this};Q.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this};Q.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a};Q.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w};var R=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,
0,0,0,0,1]};R.prototype.set=function(a,b,c,d,e,f,g,k,m,n,r,z,D,J,F,G){var C=this.elements;C[0]=a;C[4]=b;C[8]=c;C[12]=d;C[1]=e;C[5]=f;C[9]=g;C[13]=k;C[2]=m;C[6]=n;C[10]=r;C[14]=z;C[3]=D;C[7]=J;C[11]=F;C[15]=G;return this};R.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};R.prototype.clone=function(){return(new this.constructor).copy(this)};
R.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};R.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};R.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};R.prototype.multiplyMatrices=function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=c[8],g=c[12],k=c[1],m=c[5],n=c[9],r=c[13],z=c[2],D=c[6],J=c[10],F=c[14],G=c[3],C=c[7],M=c[11];c=c[15];var sa=d[0],ja=d[4],ab=d[8],bb=d[12],X=d[1],hc=d[5],ic=d[9],
jc=d[13],kc=d[2],lc=d[6],mc=d[10],nc=d[14],oc=d[3],pc=d[7],qc=d[11];d=d[15];b[0]=a*sa+e*X+f*kc+g*oc;b[4]=a*ja+e*hc+f*lc+g*pc;b[8]=a*ab+e*ic+f*mc+g*qc;b[12]=a*bb+e*jc+f*nc+g*d;b[1]=k*sa+m*X+n*kc+r*oc;b[5]=k*ja+m*hc+n*lc+r*pc;b[9]=k*ab+m*ic+n*mc+r*qc;b[13]=k*bb+m*jc+n*nc+r*d;b[2]=z*sa+D*X+J*kc+F*oc;b[6]=z*ja+D*hc+J*lc+F*pc;b[10]=z*ab+D*ic+J*mc+F*qc;b[14]=z*bb+D*jc+J*nc+F*d;b[3]=G*sa+C*X+M*kc+c*oc;b[7]=G*ja+C*hc+M*lc+c*pc;b[11]=G*ab+C*ic+M*mc+c*qc;b[15]=G*bb+C*jc+M*nc+c*d;return this};R.prototype.multiplyScalar=
function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};R.prototype.extractBasis=function(a,b,c){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);c.fromMatrix4Column(this,2);return this};R.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this};R.prototype.compose=function(a,b,c){this.fromQuaternion(b);this.scale(c);
this.setPosition(a);return this};R.prototype.scale=function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this};R.prototype.setPosition=function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};R.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=
a[14];a[14]=b;return this};R.prototype.getInverse=function(a){var b=this.elements,c=a.elements,d=b[0],e=b[1],f=b[2],g=b[3],k=b[4],m=b[5],n=b[6],r=b[7],z=b[8],D=b[9],J=b[10],F=b[11],G=b[12],C=b[13],M=b[14];b=b[15];var sa=D*M*r-C*J*r+C*n*F-m*M*F-D*n*b+m*J*b,ja=G*J*r-z*M*r-G*n*F+k*M*F+z*n*b-k*J*b,ab=z*C*r-G*D*r+G*m*F-k*C*F-z*m*b+k*D*b,bb=G*D*n-z*C*n-G*m*J+k*C*J+z*m*M-k*D*M,X=d*sa+e*ja+f*ab+g*bb;if(0===X)return a.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);X=1/X;c[0]=sa*X;c[1]=(C*J*g-D*M*g-C*f*F+e*M*F+D*f*b-
e*J*b)*X;c[2]=(m*M*g-C*n*g+C*f*r-e*M*r-m*f*b+e*n*b)*X;c[3]=(D*n*g-m*J*g-D*f*r+e*J*r+m*f*F-e*n*F)*X;c[4]=ja*X;c[5]=(z*M*g-G*J*g+G*f*F-d*M*F-z*f*b+d*J*b)*X;c[6]=(G*n*g-k*M*g-G*f*r+d*M*r+k*f*b-d*n*b)*X;c[7]=(k*J*g-z*n*g+z*f*r-d*J*r-k*f*F+d*n*F)*X;c[8]=ab*X;c[9]=(G*D*g-z*C*g-G*e*F+d*C*F+z*e*b-d*D*b)*X;c[10]=(k*C*g-G*m*g+G*e*r-d*C*r-k*e*b+d*m*b)*X;c[11]=(z*m*g-k*D*g-z*e*r+d*D*r+k*e*F-d*m*F)*X;c[12]=bb*X;c[13]=(z*C*f-G*D*f+G*e*J-d*C*J-z*e*M+d*D*M)*X;c[14]=(G*m*f-k*C*f-G*e*n+d*C*n+k*e*M-d*m*M)*X;c[15]=(k*
D*f-z*m*f+z*e*n-d*D*n-k*e*J+d*m*J)*X;return a};R.prototype.getMaxScale=function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))};R.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,k=d+d,m=e+e;a=c*g;var n=c*k;c*=m;var r=d*k;d*=m;e*=m;g*=f;k*=f;f*=m;b[0]=1-(r+e);b[4]=n-f;b[8]=c+k;b[1]=n+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-k;b[6]=d+g;b[10]=1-(a+r);b[3]=0;b[7]=0;b[11]=0;b[12]=
0;b[13]=0;b[14]=0;b[15]=1;return this};R.prototype.fromMatrix3=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=0;b[4]=a[3];b[5]=a[4];b[6]=a[5];b[7]=0;b[8]=a[6];b[9]=a[7];b[10]=a[8];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};R.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,d=0;16>d;d++)c[d]=a[d+b];return this};R.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+
4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a};R.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0};var rc=new Q,Ta=new l,sc=new l,sb=new Q,P=function(){this.name="";this.active=!0;this.children=[];this.parent=null;this.neighbors=[];this.neighborhoodRadius=1;this.updateNeighborhood=!1;this.position=new l;this.rotation=
new Q;this.scale=new l(1,1,1);this.forward=new l(0,0,1);this.up=new l(0,1,0);this.boundingRadius=0;this.maxTurnRate=Math.PI;this.canActivateTrigger=!0;this.manager=null;this._localMatrix=new R;this._worldMatrix=new R;this._cache={position:new l,rotation:new Q,scale:new l(1,1,1)};this._renderComponentCallback=this._renderComponent=null;this._started=!1;this._uuid=null;this._worldMatrixDirty=!1};P.prototype.start=function(){return this};P.prototype.update=function(){return this};P.prototype.add=function(a){null!==
a.parent&&a.parent.remove(a);this.children.push(a);a.parent=this;return this};P.prototype.remove=function(a){var b=this.children.indexOf(a);this.children.splice(b,1);a.parent=null;return this};P.prototype.getDirection=function(a){return a.copy(this.forward).applyRotation(this.rotation).normalize()};P.prototype.lookAt=function(a){var b=this.parent;null!==b?(this.getWorldPosition(sc),Ta.subVectors(a,sc).normalize(),this.rotation.lookAt(this.forward,Ta,this.up),sb.extractRotationFromMatrix(b.worldMatrix).inverse(),
this.rotation.premultiply(sb)):(Ta.subVectors(a,this.position).normalize(),this.rotation.lookAt(this.forward,Ta,this.up));return this};P.prototype.rotateTo=function(a,b,c){c=void 0===c?1E-4:c;var d=this.parent;null!==d?(this.getWorldPosition(sc),Ta.subVectors(a,sc).normalize(),rc.lookAt(this.forward,Ta,this.up),sb.extractRotationFromMatrix(d.worldMatrix).inverse(),rc.premultiply(sb)):(Ta.subVectors(a,this.position).normalize(),rc.lookAt(this.forward,Ta,this.up));return this.rotation.rotateTo(rc,this.maxTurnRate*
b,c)};P.prototype.getWorldDirection=function(a){sb.extractRotationFromMatrix(this.worldMatrix);return a.copy(this.forward).applyRotation(sb).normalize()};P.prototype.getWorldPosition=function(a){return a.extractPositionFromMatrix(this.worldMatrix)};P.prototype.setRenderComponent=function(a,b){this._renderComponent=a;this._renderComponentCallback=b;return this};P.prototype.handleMessage=function(){return!1};P.prototype.lineOfSightTest=function(){return null};P.prototype.sendMessage=function(a,b,c,
d){null!==this.manager?this.manager.sendMessage(this,a,b,void 0===c?0:c,void 0===d?null:d):E.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message.");return this};P.prototype.toJSON=function(){return{type:this.constructor.name,uuid:this.uuid,name:this.name,active:this.active,children:q(this.children),parent:null!==this.parent?this.parent.uuid:null,neighbors:q(this.neighbors),neighborhoodRadius:this.neighborhoodRadius,updateNeighborhood:this.updateNeighborhood,
position:this.position.toArray([]),rotation:this.rotation.toArray([]),scale:this.scale.toArray([]),forward:this.forward.toArray([]),up:this.up.toArray([]),boundingRadius:this.boundingRadius,maxTurnRate:this.maxTurnRate,canActivateTrigger:this.canActivateTrigger,worldMatrix:this.worldMatrix.toArray([]),_localMatrix:this._localMatrix.toArray([]),_cache:{position:this._cache.position.toArray([]),rotation:this._cache.rotation.toArray([]),scale:this._cache.scale.toArray([])},_started:this._started}};P.prototype.fromJSON=
function(a){this.name=a.name;this.active=a.active;this.neighborhoodRadius=a.neighborhoodRadius;this.updateNeighborhood=a.updateNeighborhood;this.position.fromArray(a.position);this.rotation.fromArray(a.rotation);this.scale.fromArray(a.scale);this.forward.fromArray(a.forward);this.up.fromArray(a.up);this.boundingRadius=a.boundingRadius;this.maxTurnRate=a.maxTurnRate;this.canActivateTrigger=a.canActivateTrigger;this.children=a.children.slice();this.neighbors=a.neighbors.slice();this.parent=a.parent;
this._localMatrix.fromArray(a._localMatrix);this._worldMatrix.fromArray(a.worldMatrix);this._cache.position.fromArray(a._cache.position);this._cache.rotation.fromArray(a._cache.rotation);this._cache.scale.fromArray(a._cache.scale);this._started=a._started;this._uuid=a.uuid;return this};P.prototype.resolveReferences=function(a){for(var b=this.neighbors,c=0,d=b.length;c<d;c++)b[c]=a.get(b[c]);b=this.children;c=0;for(d=b.length;c<d;c++)b[c]=a.get(b[c]);this.parent=a.get(this.parent)||null;return this};
P.prototype._updateMatrix=function(){var a=this._cache;a.position.equals(this.position)&&a.rotation.equals(this.rotation)&&a.scale.equals(this.scale)||(this._localMatrix.compose(this.position,this.rotation,this.scale),a.position.copy(this.position),a.rotation.copy(this.rotation),a.scale.copy(this.scale),this._worldMatrixDirty=!0)};P.prototype._updateWorldMatrix=function(){var a=this.parent;null!==a&&a._updateWorldMatrix();this._updateMatrix();if(!0===this._worldMatrixDirty){null===a?this._worldMatrix.copy(this._localMatrix):
this._worldMatrix.multiplyMatrices(this.parent._worldMatrix,this._localMatrix);this._worldMatrixDirty=!1;a=this.children;for(var b=0,c=a.length;b<c;b++)a[b]._worldMatrixDirty=!0}};P.prototype.updateWorldMatrix=function(){console.warn("GameEntity: .updateWorldMatrix() has been removed. World matrices are automatically updated on access.");return this};$jscomp.global.Object.defineProperties(P.prototype,{worldMatrix:{configurable:!0,enumerable:!0,get:function(){this._updateWorldMatrix();return this._worldMatrix}},
uuid:{configurable:!0,enumerable:!0,get:function(){null===this._uuid&&(this._uuid=T.generateUUID());return this._uuid}}});var Kd=new l,Yc=new l,ta=function(){var a=P.call(this)||this;a.velocity=new l;a.maxSpeed=1;a.updateOrientation=!0;return a};$jscomp.inherits(ta,P);ta.prototype.update=function(a){this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Kd.copy(this.velocity).multiplyScalar(a);Yc.copy(this.position).add(Kd);this.updateOrientation&&
1E-8<this.getSpeedSquared()&&this.lookAt(Yc);this.position.copy(Yc);return this};ta.prototype.getSpeed=function(){return this.velocity.length()};ta.prototype.getSpeedSquared=function(){return this.velocity.squaredLength()};ta.prototype.toJSON=function(){var a=P.prototype.toJSON.call(this);a.velocity=this.velocity.toArray([]);a.maxSpeed=this.maxSpeed;a.updateOrientation=this.updateOrientation;return a};ta.prototype.fromJSON=function(a){P.prototype.fromJSON.call(this,a);this.velocity.fromArray(a.velocity);
this.maxSpeed=a.maxSpeed;this.updateOrientation=a.updateOrientation;return this};var A=function(){this.active=!0;this.weight=1};A.prototype.calculate=function(){};A.prototype.toJSON=function(){return{type:this.constructor.name,active:this.active,weight:this.weight}};A.prototype.fromJSON=function(a){this.active=a.active;this.weight=a.weight;return this};A.prototype.resolveReferences=function(){};var tc=new l,uc=new l,vc=function(){return A.call(this)||this};$jscomp.inherits(vc,A);vc.prototype.calculate=
function(a,b){tc.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)c[d].getDirection(uc),tc.add(uc);0<c.length&&(tc.divideScalar(c.length),a.getDirection(uc),b.subVectors(tc,uc));return b};var Zc=new l,$c=new l,Oa=function(a,b,c){a=void 0===a?new l:a;b=void 0===b?3:b;c=void 0===c?0:c;var d=A.call(this)||this;d.target=a;d.deceleration=b;d.tolerance=c;return d};$jscomp.inherits(Oa,A);Oa.prototype.calculate=function(a,b){var c=this.deceleration;$c.subVectors(this.target,a.position);var d=$c.length();
d>this.tolerance?(c=Math.min(d/c,a.maxSpeed),Zc.copy($c).multiplyScalar(c/d)):Zc.set(0,0,0);return b.subVectors(Zc,a.velocity)};Oa.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.target=this.target.toArray([]);a.deceleration=this.deceleration;return a};Oa.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);this.deceleration=a.deceleration;return this};var ad=new l,Ia=function(a){a=void 0===a?new l:a;var b=A.call(this)||this;b.target=a;
return b};$jscomp.inherits(Ia,A);Ia.prototype.calculate=function(a,b){ad.subVectors(this.target,a.position).normalize();ad.multiplyScalar(a.maxSpeed);return b.subVectors(ad,a.velocity)};Ia.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.target=this.target.toArray([]);return a};Ia.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);return this};var wc=new l,xc=function(){var a=A.call(this)||this;a._seek=new Ia;return a};$jscomp.inherits(xc,
A);xc.prototype.calculate=function(a,b){wc.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)wc.add(c[d].position);0<c.length&&(wc.divideScalar(c.length),this._seek.target=wc,this._seek.calculate(a,b),b.normalize());return b};var Pb=new l,cb=function(a,b){a=void 0===a?new l:a;b=void 0===b?10:b;var c=A.call(this)||this;c.target=a;c.panicDistance=b;return c};$jscomp.inherits(cb,A);cb.prototype.calculate=function(a,b){var c=this.target;a.position.squaredDistanceTo(c)<=this.panicDistance*this.panicDistance&&
(Pb.subVectors(a.position,c).normalize(),0===Pb.squaredLength()&&Pb.set(0,0,1),Pb.multiplyScalar(a.maxSpeed),b.subVectors(Pb,a.velocity));return b};cb.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.target=this.target.toArray([]);a.panicDistance=this.panicDistance;return a};cb.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);this.panicDistance=a.panicDistance;return this};var Ld=new l,Md=new l,Nd=new l,db=function(a,b,c){a=void 0===
a?null:a;b=void 0===b?10:b;c=void 0===c?1:c;var d=A.call(this)||this;d.pursuer=a;d.panicDistance=b;d.predictionFactor=c;d._flee=new cb;return d};$jscomp.inherits(db,A);db.prototype.calculate=function(a,b){var c=this.pursuer;Ld.subVectors(c.position,a.position);var d=Ld.length()/(a.maxSpeed+c.getSpeed());d*=this.predictionFactor;Md.copy(c.velocity).multiplyScalar(d);Nd.addVectors(c.position,Md);this._flee.target=Nd;this._flee.panicDistance=this.panicDistance;this._flee.calculate(a,b);return b};db.prototype.toJSON=
function(){var a=A.prototype.toJSON.call(this);a.pursuer=this.pursuer?this.pursuer.uuid:null;a.panicDistance=this.panicDistance;a.predictionFactor=this.predictionFactor;return a};db.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,a);this.pursuer=a.pursuer;this.panicDistance=a.panicDistance;this.predictionFactor=a.predictionFactor;return this};db.prototype.resolveReferences=function(a){this.pursuer=a.get(this.pursuer)||null};var Ja=function(){this.loop=!1;this._waypoints=[];this._index=
0};Ja.prototype.add=function(a){this._waypoints.push(a);return this};Ja.prototype.clear=function(){this._index=this._waypoints.length=0;return this};Ja.prototype.current=function(){return this._waypoints[this._index]};Ja.prototype.finished=function(){var a=this._waypoints.length-1;return!0===this.loop?!1:this._index===a};Ja.prototype.advance=function(){this._index++;this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--);return this};Ja.prototype.toJSON=function(){for(var a=
{type:this.constructor.name,loop:this.loop,_waypoints:[],_index:this._index},b=this._waypoints,c=0,d=b.length;c<d;c++)a._waypoints.push(b[c].toArray([]));return a};Ja.prototype.fromJSON=function(a){this.loop=a.loop;this._index=a._index;a=a._waypoints;for(var b=0,c=a.length;b<c;b++){var d=a[b];this._waypoints.push((new l).fromArray(d))}return this};var tb=function(a,b){a=void 0===a?new Ja:a;b=void 0===b?1:b;var c=A.call(this)||this;c.path=a;c.nextWaypointDistance=b;c._arrive=new Oa;c._seek=new Ia;
return c};$jscomp.inherits(tb,A);tb.prototype.calculate=function(a,b){var c=this.path;c.current().squaredDistanceTo(a.position)<this.nextWaypointDistance*this.nextWaypointDistance&&c.advance();var d=c.current();!0===c.finished()?(this._arrive.target=d,this._arrive.calculate(a,b)):(this._seek.target=d,this._seek.calculate(a,b));return b};tb.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.path=this.path.toJSON();a.nextWaypointDistance=this.nextWaypointDistance;return a};tb.prototype.fromJSON=
function(a){A.prototype.fromJSON.call(this,a);this.path.fromJSON(a.path);this.nextWaypointDistance=a.nextWaypointDistance;return this};var yc=new l,zc=new l,Od=new l,Pd=new l,eb=function(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?3:c;var d=A.call(this)||this;d.entity1=a;d.entity2=b;d.deceleration=c;d._arrive=new Oa;return d};$jscomp.inherits(eb,A);eb.prototype.calculate=function(a,b){var c=this.entity1,d=this.entity2;yc.addVectors(c.position,d.position).multiplyScalar(.5);var e=a.position.distanceTo(yc)/
a.maxSpeed;zc.copy(c.velocity).multiplyScalar(e);Od.addVectors(c.position,zc);zc.copy(d.velocity).multiplyScalar(e);Pd.addVectors(d.position,zc);yc.addVectors(Od,Pd).multiplyScalar(.5);this._arrive.deceleration=this.deceleration;this._arrive.target=yc;this._arrive.calculate(a,b);return b};eb.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.entity1=this.entity1?this.entity1.uuid:null;a.entity2=this.entity2?this.entity2.uuid:null;a.deceleration=this.deceleration;return a};eb.prototype.fromJSON=
function(a){A.prototype.fromJSON.call(this,a);this.entity1=a.entity1;this.entity2=a.entity2;this.deceleration=a.deceleration;return this};eb.prototype.resolveReferences=function(a){this.entity1=a.get(this.entity1)||null;this.entity2=a.get(this.entity2)||null};var za=new l,Qb=new l,Ua=new l,Pa=[new l,new l,new l,new l,new l,new l,new l,new l],S=function(a,b){a=void 0===a?new l:a;b=void 0===b?new l:b;this.min=a;this.max=b};S.prototype.set=function(a,b){this.min=a;this.max=b;return this};S.prototype.copy=
function(a){this.min.copy(a.min);this.max.copy(a.max);return this};S.prototype.clone=function(){return(new this.constructor).copy(this)};S.prototype.clampPoint=function(a,b){b.copy(a).clamp(this.min,this.max);return b};S.prototype.containsPoint=function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0};S.prototype.expand=function(a){this.min.min(a);this.max.max(a);return this};S.prototype.getCenter=function(a){return a.addVectors(this.min,
this.max).multiplyScalar(.5)};S.prototype.getSize=function(a){return a.subVectors(this.max,this.min)};S.prototype.intersectsAABB=function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0};S.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,za);return za.squaredDistanceTo(a.center)<=a.radius*a.radius};S.prototype.intersectsPlane=function(a){var b=a.normal;this.getCenter(Qb);Ua.subVectors(this.max,
Qb);b=Ua.x*Math.abs(b.x)+Ua.y*Math.abs(b.y)+Ua.z*Math.abs(b.z);a=a.distanceToPoint(Qb);return Math.abs(a)<=b};S.prototype.getNormalFromSurfacePoint=function(a,b){b.set(0,0,0);var c=Infinity;this.getCenter(Qb);this.getSize(Ua);za.copy(a).sub(Qb);a=Math.abs(Ua.x-Math.abs(za.x));a<c&&(c=a,b.set(1*Math.sign(za.x),0,0));a=Math.abs(Ua.y-Math.abs(za.y));a<c&&(c=a,b.set(0,1*Math.sign(za.y),0));a=Math.abs(Ua.z-Math.abs(za.z));a<c&&b.set(0,0,1*Math.sign(za.z));return b};S.prototype.fromCenterAndSize=function(a,
b){za.copy(b).multiplyScalar(.5);this.min.copy(a).sub(za);this.max.copy(a).add(za);return this};S.prototype.fromPoints=function(a){this.min.set(Infinity,Infinity,Infinity);this.max.set(-Infinity,-Infinity,-Infinity);for(var b=0,c=a.length;b<c;b++)this.expand(a[b]);return this};S.prototype.applyMatrix4=function(a){var b=this.min,c=this.max;Pa[0].set(b.x,b.y,b.z).applyMatrix4(a);Pa[1].set(b.x,b.y,c.z).applyMatrix4(a);Pa[2].set(b.x,c.y,b.z).applyMatrix4(a);Pa[3].set(b.x,c.y,c.z).applyMatrix4(a);Pa[4].set(c.x,
b.y,b.z).applyMatrix4(a);Pa[5].set(c.x,b.y,c.z).applyMatrix4(a);Pa[6].set(c.x,c.y,b.z).applyMatrix4(a);Pa[7].set(c.x,c.y,c.z).applyMatrix4(a);return this.fromPoints(Pa)};S.prototype.equals=function(a){return a.min.equals(this.min)&&a.max.equals(this.max)};S.prototype.toJSON=function(){return{type:this.constructor.name,min:this.min.toArray([]),max:this.max.toArray([])}};S.prototype.fromJSON=function(a){this.min.fromArray(a.min);this.max.fromArray(a.max);return this};var bd=new S,ca=function(a,b){this.center=
a=void 0===a?new l:a;this.radius=void 0===b?0:b};ca.prototype.set=function(a,b){this.center=a;this.radius=b;return this};ca.prototype.copy=function(a){this.center.copy(a.center);this.radius=a.radius;return this};ca.prototype.clone=function(){return(new this.constructor).copy(this)};ca.prototype.clampPoint=function(a,b){b.copy(a);this.center.squaredDistanceTo(a)>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b};ca.prototype.containsPoint=
function(a){return a.squaredDistanceTo(this.center)<=this.radius*this.radius};ca.prototype.intersectsBoundingSphere=function(a){var b=this.radius+a.radius;return a.center.squaredDistanceTo(this.center)<=b*b};ca.prototype.intersectsPlane=function(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius};ca.prototype.getNormalFromSurfacePoint=function(a,b){return b.subVectors(a,this.center).normalize()};ca.prototype.fromPoints=function(a){bd.fromPoints(a);bd.getCenter(this.center);this.radius=
this.center.distanceTo(bd.max);return this};ca.prototype.applyMatrix4=function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScale();return this};ca.prototype.equals=function(a){return a.center.equals(this.center)&&a.radius===this.radius};ca.prototype.toJSON=function(){return{type:this.constructor.name,center:this.center.toArray([]),radius:this.radius}};ca.prototype.fromJSON=function(a){this.center.fromArray(a.center);this.radius=a.radius;return this};var Aa=new l,cd=new l,Ac=new l,dd=new l,
Qd=new l,Bc=new R,Ge=new R,Rd=new S,Y=function(a,b){a=void 0===a?new l:a;b=void 0===b?new l:b;this.origin=a;this.direction=b};Y.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};Y.prototype.copy=function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this};Y.prototype.clone=function(){return(new this.constructor).copy(this)};Y.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};Y.prototype.intersectBoundingSphere=
function(a,b){Aa.subVectors(a.center,this.origin);var c=Aa.dot(this.direction),d=Aa.dot(Aa)-c*c;a=a.radius*a.radius;if(d>a)return null;a=Math.sqrt(a-d);d=c-a;c+=a;return 0>d&&0>c?null:0>d?this.at(c,b):this.at(d,b)};Y.prototype.intersectsBoundingSphere=function(a){var b=new l,c=b.subVectors(a.center,this.origin).dot(this.direction);0>c?b=this.origin.squaredDistanceTo(a.center):(b.copy(this.direction).multiplyScalar(c).add(this.origin),b=b.squaredDistanceTo(a.center));return b<=a.radius*a.radius};Y.prototype.intersectAABB=
function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var k=(a.min.y-f.y)*d;d*=a.max.y-f.y}else k=(a.max.y-f.y)*d,d*=a.min.y-f.y;if(g>d||k>c)return null;if(k>g||g!==g)g=k;if(d<c||c!==c)c=d;0<=e?(k=(a.min.z-f.z)*e,a=(a.max.z-f.z)*e):(k=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>a||k>c)return null;if(k>g||g!==g)g=k;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?
g:c,b)};Y.prototype.intersectsAABB=function(a){return null!==this.intersectAABB(a,Aa)};Y.prototype.intersectPlane=function(a,b){var c=a.normal.dot(this.direction);if(0===c)if(0===a.distanceToPoint(this.origin))a=0;else return null;else a=-(this.origin.dot(a.normal)+a.constant)/c;return 0<=a?this.at(a,b):null};Y.prototype.intersectsPlane=function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1};Y.prototype.intersectOBB=function(a,b){a.getSize(Qd);Rd.fromCenterAndSize(Aa.set(0,
0,0),Qd);Bc.fromMatrix3(a.rotation);Bc.setPosition(a.center);Sd.copy(this).applyMatrix4(Bc.getInverse(Ge));return Sd.intersectAABB(Rd,b)?b.applyMatrix4(Bc):null};Y.prototype.intersectsOBB=function(a){return null!==this.intersectOBB(a,Aa)};Y.prototype.intersectConvexHull=function(a,b){a=a.faces;for(var c=-Infinity,d=Infinity,e=0,f=a.length;e<f;e++){var g=a[e].plane,k=g.distanceToPoint(this.origin);g=g.normal.dot(this.direction);if(0<k&&0<=g)return null;k=0!==g?-k/g:0;if(!(0>=k)&&(0<g?d=Math.min(k,
d):c=Math.max(k,c),c>d))return null}-Infinity!==c?this.at(c,b):this.at(d,b);return b};Y.prototype.intersectsConvexHull=function(a){return null!==this.intersectConvexHull(a,Aa)};Y.prototype.intersectTriangle=function(a,b,c){var d=a.a,e=a.c;cd.subVectors(a.b,d);Ac.subVectors(e,d);dd.crossVectors(cd,Ac);a=this.direction.dot(dd);if(0<a){if(b)return null;b=1}else if(0>a)b=-1,a=-a;else return null;Aa.subVectors(this.origin,d);d=b*this.direction.dot(Ac.crossVectors(Aa,Ac));if(0>d)return null;e=b*this.direction.dot(cd.cross(Aa));
if(0>e||d+e>a)return null;d=-b*Aa.dot(dd);return 0>d?null:this.at(d/a,c)};Y.prototype.intersectBVH=function(a,b){return a.root.intersectRay(this,b)};Y.prototype.intersectsBVH=function(a){return a.root.intersectsRay(this)};Y.prototype.applyMatrix4=function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this};Y.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};var Sd=new Y,Td=new R,ub=new l,Cc=new l,ed=new l,fd=new ca,He=
new Y(new l(0,0,0),new l(0,0,1)),fb=function(a){a=void 0===a?[]:a;var b=A.call(this)||this;b.obstacles=a;b.brakingWeight=.2;b.dBoxMinLength=4;return b};$jscomp.inherits(fb,A);fb.prototype.calculate=function(a,b){var c=this.obstacles,d=null,e=Infinity,f=this.dBoxMinLength+a.getSpeed()/a.maxSpeed*this.dBoxMinLength;a.worldMatrix.getInverse(Td);for(var g=0,k=c.length;g<k;g++){var m=c[g];if(m!==a&&(ub.copy(m.position).applyMatrix4(Td),0<ub.z&&Math.abs(ub.z)<f)){var n=m.boundingRadius+a.boundingRadius;
Math.abs(ub.x)<n&&(fd.center.copy(ub),fd.radius=n,He.intersectBoundingSphere(fd,ed),ed.z<e&&(e=ed.z,d=m,Cc.copy(ub)))}}null!==d&&(b.x=(d.boundingRadius-Cc.x)*(1+(f-Cc.z)/f),b.z=(d.boundingRadius-Cc.z)*this.brakingWeight,b.applyRotation(a.rotation));return b};fb.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.obstacles=[];a.brakingWeight=this.brakingWeight;a.dBoxMinLength=this.dBoxMinLength;for(var b=0,c=this.obstacles.length;b<c;b++)a.obstacles.push(this.obstacles[b].uuid);return a};
fb.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,a);this.obstacles=a.obstacles;this.brakingWeight=a.brakingWeight;this.dBoxMinLength=a.dBoxMinLength;return this};fb.prototype.resolveReferences=function(a){for(var b=this.obstacles,c=0,d=b.length;c<d;c++)b[c]=a.get(b[c])};var gd=new l,Ud=new l,Vd=new l,Wd=new l,gb=function(a,b){a=void 0===a?null:a;b=void 0===b?new l:b;var c=A.call(this)||this;c.leader=a;c.offset=b;c._arrive=new Oa;c._arrive.deceleration=1.5;return c};$jscomp.inherits(gb,
A);gb.prototype.calculate=function(a,b){var c=this.leader;gd.copy(this.offset).applyMatrix4(c.worldMatrix);Ud.subVectors(gd,a.position);var d=Ud.length()/(a.maxSpeed+c.getSpeed());Vd.copy(c.velocity).multiplyScalar(d);Wd.addVectors(gd,Vd);this._arrive.target=Wd;this._arrive.calculate(a,b);return b};gb.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.leader=this.leader?this.leader.uuid:null;a.offset=this.offset;return a};gb.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,
a);this.leader=a.leader;this.offset=a.offset;return this};gb.prototype.resolveReferences=function(a){this.leader=a.get(this.leader)||null};var hd=new l,id=new l,Xd=new l,Yd=new l,Zd=new l,hb=function(a,b){a=void 0===a?null:a;b=void 0===b?1:b;var c=A.call(this)||this;c.evader=a;c.predictionFactor=b;c._seek=new Ia;return c};$jscomp.inherits(hb,A);hb.prototype.calculate=function(a,b){var c=this.evader;hd.subVectors(c.position,a.position);a.getDirection(id);c.getDirection(Xd);var d=0<hd.dot(id),e=-.95>
id.dot(Xd);if(!0===d&&!0===e)return this._seek.target=c.position,this._seek.calculate(a,b),b;d=hd.length()/(a.maxSpeed+c.getSpeed());d*=this.predictionFactor;Yd.copy(c.velocity).multiplyScalar(d);Zd.addVectors(c.position,Yd);this._seek.target=Zd;this._seek.calculate(a,b);return b};hb.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.evader=this.evader?this.evader.uuid:null;a.predictionFactor=this.predictionFactor;return a};hb.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,
a);this.evader=a.evader;this.predictionFactor=a.predictionFactor;return this};hb.prototype.resolveReferences=function(a){this.evader=a.get(this.evader)||null};var Dc=new l,Ec=function(){return A.call(this)||this};$jscomp.inherits(Ec,A);Ec.prototype.calculate=function(a,b){for(var c=a.neighbors,d=0,e=c.length;d<e;d++){Dc.subVectors(a.position,c[d].position);var f=Dc.length();0===f&&(f=1E-4);Dc.normalize().divideScalar(f);b.add(Dc)}return b};var Rb=new l,jd=new l,vb=function(a,b,c){a=void 0===a?1:a;
b=void 0===b?5:b;c=void 0===c?5:c;var d=A.call(this)||this;d.radius=a;d.distance=b;d.jitter=c;d._targetLocal=new l;a=d.radius;b=d._targetLocal;c=Math.random()*Math.PI*2;b.x=a*Math.cos(c);b.z=a*Math.sin(c);return d};$jscomp.inherits(vb,A);vb.prototype.calculate=function(a,b,c){c*=this.jitter;jd.x=T.randFloat(-1,1)*c;jd.z=T.randFloat(-1,1)*c;this._targetLocal.add(jd);this._targetLocal.normalize();this._targetLocal.multiplyScalar(this.radius);Rb.copy(this._targetLocal);Rb.z+=this.distance;Rb.applyMatrix4(a.worldMatrix);
b.subVectors(Rb,a.position);return b};vb.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.radius=this.radius;a.distance=this.distance;a.jitter=this.jitter;a._targetLocal=this._targetLocal.toArray([]);return a};vb.prototype.fromJSON=function(a){A.prototype.fromJSON.call(this,a);this.radius=a.radius;this.distance=a.distance;this.jitter=a.jitter;this._targetLocal.fromArray(a._targetLocal);return this};var Fc=new l,ua=function(a){this.vehicle=a;this.behaviors=[];this._steeringForce=new l;
this._typesMap=new Map};ua.prototype.add=function(a){this.behaviors.push(a);return this};ua.prototype.remove=function(a){a=this.behaviors.indexOf(a);this.behaviors.splice(a,1);return this};ua.prototype.clear=function(){this.behaviors.length=0;return this};ua.prototype.calculate=function(a,b){this._calculateByOrder(a);return b.copy(this._steeringForce)};ua.prototype._accumulate=function(a){var b=this._steeringForce.length();b=this.vehicle.maxForce-b;if(0>=b)return!1;a.length()>b&&a.normalize().multiplyScalar(b);
this._steeringForce.add(a);return!0};ua.prototype._calculateByOrder=function(a){var b=this.behaviors;this._steeringForce.set(0,0,0);for(var c=0,d=b.length;c<d;c++){var e=b[c];if(!0===e.active&&(Fc.set(0,0,0),e.calculate(this.vehicle,Fc,a),Fc.multiplyScalar(e.weight),!1===this._accumulate(Fc)))break}};ua.prototype.toJSON=function(){for(var a={type:"SteeringManager",behaviors:[]},b=this.behaviors,c=0,d=b.length;c<d;c++)a.behaviors.push(b[c].toJSON());return a};ua.prototype.fromJSON=function(a){this.clear();
a=a.behaviors;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.type;switch(e){case "SteeringBehavior":d=(new A).fromJSON(d);break;case "AlignmentBehavior":d=(new vc).fromJSON(d);break;case "ArriveBehavior":d=(new Oa).fromJSON(d);break;case "CohesionBehavior":d=(new xc).fromJSON(d);break;case "EvadeBehavior":d=(new db).fromJSON(d);break;case "FleeBehavior":d=(new cb).fromJSON(d);break;case "FollowPathBehavior":d=(new tb).fromJSON(d);break;case "InterposeBehavior":d=(new eb).fromJSON(d);break;case "ObstacleAvoidanceBehavior":d=
(new fb).fromJSON(d);break;case "OffsetPursuitBehavior":d=(new gb).fromJSON(d);break;case "PursuitBehavior":d=(new hb).fromJSON(d);break;case "SeekBehavior":d=(new Ia).fromJSON(d);break;case "SeparationBehavior":d=(new Ec).fromJSON(d);break;case "WanderBehavior":d=(new vb).fromJSON(d);break;default:var f=this._typesMap.get(e);if(void 0!==f)d=(new f).fromJSON(d);else{E.warn("YUKA.SteeringManager: Unsupported steering behavior type:",e);continue}}this.add(d)}return this};ua.prototype.registerType=function(a,
b){this._typesMap.set(a,b);return this};ua.prototype.resolveReferences=function(a){for(var b=this.behaviors,c=0,d=b.length;c<d;c++)b[c].resolveReferences(a);return this};var Sb=function(a){this.count=void 0===a?10:a;this._history=[];for(a=this._slot=0;a<this.count;a++)this._history[a]=new l};Sb.prototype.calculate=function(a,b){b.set(0,0,0);this._slot===this.count&&(this._slot=0);this._history[this._slot].copy(a);this._slot++;for(a=0;a<this.count;a++)b.add(this._history[a]);b.divideScalar(this.count);
return b};Sb.prototype.toJSON=function(){for(var a={type:this.constructor.name,count:this.count,_history:[],_slot:this._slot},b=this._history,c=0,d=b.length;c<d;c++)a._history.push(b[c].toArray([]));return a};Sb.prototype.fromJSON=function(a){this.count=a.count;this._slot=a._slot;a=a._history;for(var b=this._history.length=0,c=a.length;b<c;b++){var d=a[b];this._history.push((new l).fromArray(d))}return this};var $d=new l,Gc=new l,ae=new l,Tb=new l,be=new l,ib=function(){var a=ta.call(this)||this;
a.mass=1;a.maxForce=100;a.steering=new ua(a);a.smoother=null;return a};$jscomp.inherits(ib,ta);ib.prototype.update=function(a){this.steering.calculate(a,$d);ae.copy($d).divideScalar(this.mass);this.velocity.add(ae.multiplyScalar(a));this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Gc.copy(this.velocity).multiplyScalar(a);Tb.copy(this.position).add(Gc);!0===this.updateOrientation&&null===this.smoother&&1E-8<this.getSpeedSquared()&&
this.lookAt(Tb);this.position.copy(Tb);!0===this.updateOrientation&&null!==this.smoother&&(this.smoother.calculate(this.velocity,be),Gc.copy(be).multiplyScalar(a),Tb.copy(this.position).add(Gc),this.lookAt(Tb));return this};ib.prototype.toJSON=function(){var a=ta.prototype.toJSON.call(this);a.mass=this.mass;a.maxForce=this.maxForce;a.steering=this.steering.toJSON();a.smoother=this.smoother?this.smoother.toJSON():null;return a};ib.prototype.fromJSON=function(a){ta.prototype.fromJSON.call(this,a);this.mass=
a.mass;this.maxForce=a.maxForce;this.steering=(new ua(this)).fromJSON(a.steering);this.smoother=a.smoother?(new Sb).fromJSON(a.smoother):null;return this};ib.prototype.resolveReferences=function(a){ta.prototype.resolveReferences.call(this,a);this.steering.resolveReferences(a)};var va=function(){};va.prototype.touching=function(){return!1};va.prototype.update=function(){return this};va.prototype.toJSON=function(){return{type:this.constructor.name}};va.prototype.fromJSON=function(){return this};var ce=
new ca,de=new l,jb=function(a){this.size=a=void 0===a?new l:a;this._aabb=new S;return this};$jscomp.inherits(jb,va);jb.prototype.touching=function(a){ce.set(a.position,a.boundingRadius);return this._aabb.intersectsBoundingSphere(ce)};jb.prototype.update=function(a){a.getWorldPosition(de);this._aabb.fromCenterAndSize(de,this.size);return this};jb.prototype.toJSON=function(){var a=va.prototype.toJSON.call(this);a.size=this.size.toArray([]);return a};jb.prototype.fromJSON=function(a){va.prototype.fromJSON.call(this,
a);this.size.fromArray(a.size);return this};var kd=new ca,kb=function(a){this.radius=void 0===a?0:a;this._boundingSphere=new ca;return this};$jscomp.inherits(kb,va);kb.prototype.touching=function(a){a.getWorldPosition(kd.center);kd.radius=a.boundingRadius;return this._boundingSphere.intersectsBoundingSphere(kd)};kb.prototype.update=function(a){a.getWorldPosition(this._boundingSphere.center);this._boundingSphere.radius=this.radius;return this};kb.prototype.toJSON=function(){var a=va.prototype.toJSON.call(this);
a.radius=this.radius;return a};kb.prototype.fromJSON=function(a){va.prototype.fromJSON.call(this,a);this.radius=a.radius;return this};var Ka=function(a){a=void 0===a?new va:a;var b=P.call(this)||this;b.region=a;b.canActivateTrigger=!1;b._typesMap=new Map;return b};$jscomp.inherits(Ka,P);Ka.prototype.check=function(a){!0===this.region.touching(a)&&this.execute(a);return this};Ka.prototype.execute=function(){};Ka.prototype.updateRegion=function(){this.region.update(this);return this};Ka.prototype.toJSON=
function(){var a=P.prototype.toJSON.call(this);a.region=this.region.toJSON();return a};Ka.prototype.fromJSON=function(a){P.prototype.fromJSON.call(this,a);a=a.region;var b=a.type;switch(b){case "TriggerRegion":this.region=(new va).fromJSON(a);break;case "RectangularTriggerRegion":this.region=(new jb).fromJSON(a);break;case "SphericalTriggerRegion":this.region=(new kb).fromJSON(a);break;default:b=this._typesMap.get(b),void 0!==b?this.region=(new b).fromJSON(a):E.warn("YUKA.Trigger: Unsupported trigger region type:",
a.type)}return this};Ka.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};var wb=[],wa=function(){this.entities=[];this.spatialIndex=null;this._triggers=[];this._indexMap=new Map;this._typesMap=new Map;this._messageDispatcher=new ra};wa.prototype.add=function(a){this.entities.push(a);a.manager=this;return this};wa.prototype.remove=function(a){var b=this.entities.indexOf(a);this.entities.splice(b,1);a.manager=null;return this};wa.prototype.clear=function(){this.entities.length=
0;this._messageDispatcher.clear();return this};wa.prototype.getEntityByName=function(a){for(var b=this.entities,c=0,d=b.length;c<d;c++){var e=b[c];if(e.name===a)return e}return null};wa.prototype.update=function(a){for(var b=this.entities,c=this._triggers,d=b.length-1;0<=d;d--)this.updateEntity(b[d],a);for(b=c.length-1;0<=b;b--)this.processTrigger(c[b]);this._triggers.length=0;this._messageDispatcher.dispatchDelayedMessages(a);return this};wa.prototype.updateEntity=function(a,b){if(!0===a.active){this.updateNeighborhood(a);
!1===a._started&&(a.start(),a._started=!0);a.update(b);for(var c=a.children,d=c.length-1;0<=d;d--)this.updateEntity(c[d],b);a instanceof Ka&&this._triggers.push(a);null!==this.spatialIndex&&(b=this._indexMap.get(a)||-1,b=this.spatialIndex.updateEntity(a,b),this._indexMap.set(a,b));b=a._renderComponent;c=a._renderComponentCallback;null!==b&&null!==c&&c(a,b)}return this};wa.prototype.updateNeighborhood=function(a){if(!0===a.updateNeighborhood){a.neighbors.length=0;null!==this.spatialIndex?this.spatialIndex.query(a.position,
a.neighborhoodRadius,wb):(wb.length=0,wb.push.apply(wb,$jscomp.arrayFromIterable(this.entities)));for(var b=a.neighborhoodRadius*a.neighborhoodRadius,c=0,d=wb.length;c<d;c++){var e=wb[c];a!==e&&!0===e.active&&a.position.squaredDistanceTo(e.position)<=b&&a.neighbors.push(e)}}return this};wa.prototype.processTrigger=function(a){a.updateRegion();for(var b=this.entities,c=b.length-1;0<=c;c--){var d=b[c];a!==d&&!0===d.active&&!0===d.canActivateTrigger&&a.check(d)}return this};wa.prototype.sendMessage=
function(a,b,c,d,e){this._messageDispatcher.dispatch(a,b,c,d,e);return this};wa.prototype.toJSON=function(){function a(e){b.entities.push(e.toJSON());for(var f=0,g=e.children.length;f<g;f++)a(e.children[f])}for(var b={type:this.constructor.name,entities:[],_messageDispatcher:this._messageDispatcher.toJSON()},c=0,d=this.entities.length;c<d;c++)a(this.entities[c]);return b};wa.prototype.fromJSON=function(a){this.clear();var b=a.entities;a=a._messageDispatcher;for(var c=new Map,d=0,e=b.length;d<e;d++){var f=
b[d],g=f.type;switch(g){case "GameEntity":f=(new P).fromJSON(f);break;case "MovingEntity":f=(new ta).fromJSON(f);break;case "Vehicle":f=(new ib).fromJSON(f);break;case "Trigger":f=(new Ka).fromJSON(f);break;default:var k=this._typesMap.get(g);if(void 0!==k)f=(new k).fromJSON(f);else{E.warn("YUKA.EntityManager: Unsupported entity type:",g);continue}}c.set(f.uuid,f);null===f.parent&&this.add(f)}b=$jscomp.makeIterator(c.values());for(d=b.next();!d.done;d=b.next())d.value.resolveReferences(c);this._messageDispatcher.fromJSON(a);
return this};wa.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};var Ub=function(){this._events=new Map};Ub.prototype.addEventListener=function(a,b){var c=this._events;!1===c.has(a)&&c.set(a,[]);a=c.get(a);-1===a.indexOf(b)&&a.push(b)};Ub.prototype.removeEventListener=function(a,b){a=this._events.get(a);void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1))};Ub.prototype.hasEventListener=function(a,b){a=this._events.get(a);return void 0!==a&&-1!==a.indexOf(b)};Ub.prototype.dispatchEvent=
function(a){var b=this._events.get(a.type);if(void 0!==b){a.target=this;for(var c=0,d=b.length;c<d;c++)b[c].call(this,a)}};var xb=new l,ld=new l,Hc=new l,na=function(a,b){this.normal=a=void 0===a?new l(0,0,1):a;this.constant=void 0===b?0:b};na.prototype.set=function(a,b){this.normal=a;this.constant=b;return this};na.prototype.copy=function(a){this.normal.copy(a.normal);this.constant=a.constant;return this};na.prototype.clone=function(){return(new this.constructor).copy(this)};na.prototype.distanceToPoint=
function(a){return this.normal.dot(a)+this.constant};na.prototype.fromNormalAndCoplanarPoint=function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this};na.prototype.fromCoplanarPoints=function(a,b,c){xb.subVectors(c,b).cross(ld.subVectors(a,b)).normalize();this.fromNormalAndCoplanarPoint(xb,a);return this};na.prototype.intersectPlane=function(a,b){Hc.crossVectors(this.normal,a.normal);var c=Hc.dot(Hc);if(0===c)return null;xb.copy(a.normal).multiplyScalar(this.constant);ld.copy(this.normal).multiplyScalar(a.constant);
b.crossVectors(xb.sub(ld),Hc).divideScalar(c);return b};na.prototype.intersectsPlane=function(a){a=this.normal.dot(a.normal);return 1!==Math.abs(a)};na.prototype.projectPoint=function(a,b){xb.copy(this.normal).multiplyScalar(this.distanceToPoint(a));b.subVectors(a,xb);return b};na.prototype.equals=function(a){return a.normal.equals(this.normal)&&a.constant===this.constant};var ee=new ca,da={a:new l,b:new l,c:new l},yb=new Y,fe=new na,ge=new R,md=new l,nd=new l,od=new l,pd=new l,lb=function(a,b){this.vertices=
a=void 0===a?new Float32Array:a;this.indices=void 0===b?null:b;this.backfaceCulling=!0;this.aabb=new S;this.boundingSphere=new ca;this.computeBoundingVolume()};lb.prototype.computeBoundingVolume=function(){var a=this.vertices,b=new l,c=this.aabb,d=this.boundingSphere;c.min.set(Infinity,Infinity,Infinity);c.max.set(-Infinity,-Infinity,-Infinity);for(var e=0,f=a.length;e<f;e+=3)b.x=a[e],b.y=a[e+1],b.z=a[e+2],c.expand(b);c.getCenter(d.center);d.radius=d.center.distanceTo(c.max);return this};lb.prototype.intersectRay=
function(a,b,c,d,e){e=void 0===e?null:e;ee.copy(this.boundingSphere).applyMatrix4(b);if(a.intersectsBoundingSphere(ee)&&(b.getInverse(ge),yb.copy(a).applyMatrix4(ge),yb.intersectsAABB(this.aabb))){a=this.vertices;var f=this.indices,g=Infinity,k=!1;if(null===f){f=0;for(var m=a.length;f<m;f+=9)if(da.a.set(a[f],a[f+1],a[f+2]),da.b.set(a[f+3],a[f+4],a[f+5]),da.c.set(a[f+6],a[f+7],a[f+8]),null!==yb.intersectTriangle(da,this.backfaceCulling,d))if(c){var n=d.squaredDistanceTo(yb.origin);n<g&&(g=n,md.copy(d),
nd.copy(da.a),od.copy(da.b),pd.copy(da.c),k=!0)}else{k=!0;break}}else for(m=0,n=f.length;m<n;m+=3){var r=f[m],z=f[m+1],D=f[m+2];da.a.set(a[3*r],a[3*r+1],a[3*r+2]);da.b.set(a[3*z],a[3*z+1],a[3*z+2]);da.c.set(a[3*D],a[3*D+1],a[3*D+2]);if(null!==yb.intersectTriangle(da,this.backfaceCulling,d))if(c)r=d.squaredDistanceTo(yb.origin),r<g&&(g=r,md.copy(d),nd.copy(da.a),od.copy(da.b),pd.copy(da.c),k=!0);else{k=!0;break}}if(k)return c&&(d.copy(md),da.a.copy(nd),da.b.copy(od),da.c.copy(pd)),d.applyMatrix4(b),
null!==e&&(fe.fromCoplanarPoints(da.a,da.b,da.c),e.copy(fe.normal),e.transformDirection(b)),d}return null};lb.prototype.toTriangleSoup=function(){var a=this.indices;if(a){for(var b=this.vertices,c=new Float32Array(3*a.length),d=0,e=a.length;d<e;d++){var f=a[d];c[3*d]=b[3*f];c[3*d+1]=b[3*f+1];c[3*d+2]=b[3*f+2]}return new lb(c)}return this};lb.prototype.toJSON=function(){var a={type:this.constructor.name};a.indices={type:this.indices?this.indices.constructor.name:"null",data:this.indices?Array.from(this.indices):
null};a.vertices=Array.from(this.vertices);a.backfaceCulling=this.backfaceCulling;a.aabb=this.aabb.toJSON();a.boundingSphere=this.boundingSphere.toJSON();return a};lb.prototype.fromJSON=function(a){this.aabb=(new S).fromJSON(a.aabb);this.boundingSphere=(new ca).fromJSON(a.boundingSphere);this.backfaceCulling=a.backfaceCulling;this.vertices=new Float32Array(a.vertices);switch(a.indices.type){case "Uint16Array":this.indices=new Uint16Array(a.indices.data);break;case "Uint32Array":this.indices=new Uint32Array(a.indices.data);
break;case "null":this.indices=null}return this};var oa=function(){this._elapsed=this._delta=this._currentTime=this._previousTime=0;this._timescale=1;this._useFixedDelta=!1;this._fixedDelta=16.67;this._usePageVisibilityAPI="undefined"!==typeof document&&void 0!==document.hidden;!0===this._usePageVisibilityAPI&&(this._pageVisibilityHandler=p.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))};oa.prototype.disableFixedDelta=function(){this._useFixedDelta=!1;return this};
oa.prototype.dispose=function(){!0===this._usePageVisibilityAPI&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler);return this};oa.prototype.enableFixedDelta=function(){this._useFixedDelta=!0;return this};oa.prototype.getDelta=function(){return this._delta/1E3};oa.prototype.getElapsed=function(){return this._elapsed/1E3};oa.prototype.getFixedDelta=function(){return this._fixedDelta/1E3};oa.prototype.getTimescale=function(){return this._timescale};oa.prototype.reset=function(){this._currentTime=
this._now();return this};oa.prototype.setFixedDelta=function(a){this._fixedDelta=1E3*a;return this};oa.prototype.setTimescale=function(a){this._timescale=a;return this};oa.prototype.update=function(){!0===this._useFixedDelta?this._delta=this._fixedDelta:(this._previousTime=this._currentTime,this._currentTime=this._now(),this._delta=this._currentTime-this._previousTime);this._delta*=this._timescale;this._elapsed+=this._delta;return this};oa.prototype._now=function(){return("undefined"===typeof performance?
Date:performance).now()};var he=function(a){this.updateFrequency=void 0===a?0:a;this._time=new oa;this._nextUpdateTime=0};he.prototype.ready=function(){this._time.update();var a=this._time.getElapsed();return a>=this._nextUpdateTime?(this._nextUpdateTime=a+1/this.updateFrequency,!0):!1};var Qa=function(){};Qa.prototype.enter=function(){};Qa.prototype.execute=function(){};Qa.prototype.exit=function(){};Qa.prototype.toJSON=function(){};Qa.prototype.fromJSON=function(){};Qa.prototype.resolveReferences=
function(){};Qa.prototype.onMessage=function(){return!1};var pa=function(a){this.owner=void 0===a?null:a;this.globalState=this.previousState=this.currentState=null;this.states=new Map;this._typesMap=new Map};pa.prototype.update=function(){null!==this.globalState&&this.globalState.execute(this.owner);null!==this.currentState&&this.currentState.execute(this.owner);return this};pa.prototype.add=function(a,b){b instanceof Qa?this.states.set(a,b):E.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".');
return this};pa.prototype.remove=function(a){this.states.delete(a);return this};pa.prototype.get=function(a){return this.states.get(a)};pa.prototype.changeTo=function(a){a=this.get(a);this._change(a);return this};pa.prototype.revert=function(){this._change(this.previousState);return this};pa.prototype.in=function(a){return this.get(a)===this.currentState};pa.prototype.handleMessage=function(a){return null!==this.currentState&&!0===this.currentState.onMessage(this.owner,a)||null!==this.globalState&&
!0===this.globalState.onMessage(this.owner,a)?!0:!1};pa.prototype.toJSON=function(){for(var a={owner:this.owner.uuid,currentState:null,previousState:null,globalState:null,states:[]},b=new Map,c=$jscomp.makeIterator(this.states),d=c.next();!d.done;d=c.next()){var e=$jscomp.makeIterator(d.value);d=e.next().value;e=e.next().value;a.states.push({type:e.constructor.name,id:d,state:e.toJSON()});b.set(e,d)}a.currentState=b.get(this.currentState)||null;a.previousState=b.get(this.previousState)||null;a.globalState=
b.get(this.globalState)||null;return a};pa.prototype.fromJSON=function(a){this.owner=a.owner;for(var b=a.states,c=0,d=b.length;c<d;c++){var e=b[c],f=e.type,g=this._typesMap.get(f);void 0!==g?(f=e.id,e=(new g).fromJSON(e.state),this.add(f,e)):E.warn("YUKA.StateMachine: Unsupported state type:",f)}this.currentState=null!==a.currentState?this.get(a.currentState)||null:null;this.previousState=null!==a.previousState?this.get(a.previousState)||null:null;this.globalState=null!==a.globalState?this.get(a.globalState)||
null:null;return this};pa.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=$jscomp.makeIterator(this.states.values()),c=b.next();!c.done;c=b.next())c.value.resolveReferences(a);return this};pa.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};pa.prototype._change=function(a){this.previousState=this.currentState;null!==this.currentState&&this.currentState.exit(this.owner);this.currentState=a;this.currentState.enter(this.owner)};var Ra=function(){};
Ra.prototype.clearDegreeOfMembership=function(){};Ra.prototype.getDegreeOfMembership=function(){};Ra.prototype.updateDegreeOfMembership=function(){};Ra.prototype.toJSON=function(){return{type:this.constructor.name}};var ka=function(a){this.terms=a=void 0===a?[]:a;return this};$jscomp.inherits(ka,Ra);ka.prototype.clearDegreeOfMembership=function(){for(var a=this.terms,b=0,c=a.length;b<c;b++)a[b].clearDegreeOfMembership();return this};ka.prototype.updateDegreeOfMembership=function(a){for(var b=this.terms,
c=0,d=b.length;c<d;c++)b[c].updateDegreeOfMembership(a);return this};ka.prototype.toJSON=function(){var a=Ra.prototype.toJSON.call(this);a.terms=[];for(var b=0,c=this.terms.length;b<c;b++){var d=this.terms[b];d instanceof ka?a.terms.push(d.toJSON()):a.terms.push(d.uuid)}return a};var Ic=function(){var a=Array.from(arguments);return ka.call(this,a)||this};$jscomp.inherits(Ic,ka);Ic.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=Infinity,c=0,d=a.length;c<d;c++){var e=a[c].getDegreeOfMembership();
e<b&&(b=e)}return b};var zb=function(a){a=void 0===a?null:a;return ka.call(this,null!==a?[a]:[])||this};$jscomp.inherits(zb,ka);zb.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();return this};zb.prototype.getDegreeOfMembership=function(){var a=this.terms[0].getDegreeOfMembership();return Math.sqrt(a)};zb.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(Math.sqrt(a));return this};var Jc=function(){var a=Array.from(arguments);
return ka.call(this,a)||this};$jscomp.inherits(Jc,ka);Jc.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=-Infinity,c=0,d=a.length;c<d;c++){var e=a[c].getDegreeOfMembership();e>b&&(b=e)}return b};var Ab=function(a){a=void 0===a?null:a;return ka.call(this,null!==a?[a]:[])||this};$jscomp.inherits(Ab,ka);Ab.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();return this};Ab.prototype.getDegreeOfMembership=function(){var a=this.terms[0].getDegreeOfMembership();
return a*a};Ab.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(a*a);return this};var L=function(a){this.degreeOfMembership=0;this.representativeValue=void 0===a?0:a;this.right=this.left=0;this._uuid=null;return this};$jscomp.inherits(L,Ra);L.prototype.computeDegreeOfMembership=function(){};L.prototype.clearDegreeOfMembership=function(){this.degreeOfMembership=0;return this};L.prototype.getDegreeOfMembership=function(){return this.degreeOfMembership};L.prototype.updateDegreeOfMembership=
function(a){a>this.degreeOfMembership&&(this.degreeOfMembership=a);return this};L.prototype.toJSON=function(){var a=Ra.prototype.toJSON.call(this);a.degreeOfMembership=this.degreeOfMembership;a.representativeValue=this.representativeValue;a.left=this.left;a.right=this.right;a.uuid=this.uuid;return a};L.prototype.fromJSON=function(a){this.degreeOfMembership=a.degreeOfMembership;this.representativeValue=a.representativeValue;this.left=a.left;this.right=a.right;this._uuid=a.uuid;return this};$jscomp.global.Object.defineProperties(L.prototype,
{uuid:{configurable:!0,enumerable:!0,get:function(){null===this._uuid&&(this._uuid=T.generateUUID());return this._uuid}}});var Vb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=L.call(this,(b+a)/2)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(Vb,L);Vb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.right;return a>=this.left&&a<=b?1:a>b&&a<=c?a>=(b+c)/2?2*Math.pow((a-c)/(b-c),2):1-2*Math.pow((a-b)/(b-c),2):0};Vb.prototype.toJSON=
function(){var a=L.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};Vb.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var Bb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=L.call(this,(b+a)/2)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(Bb,L);Bb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.right;return a>=this.left&&a<=b?1:a>b&&a<=c?1/(c-b)*(c-a):0};Bb.prototype.toJSON=
function(){var a=L.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};Bb.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var Cb=function(a,b,c,d){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;var e=L.call(this,b)||this;e.left=a;e.midpoint=b;e.right=c;e.standardDeviation=d;e._cache={};return e};$jscomp.inherits(Cb,L);Cb.prototype.computeDegreeOfMembership=function(a){this._updateCache();return a>=this.right||a<=
this.left?0:v(a,this.midpoint,this._cache.variance)/this._cache.normalizationFactor};Cb.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.midpoint=this.midpoint;a.standardDeviation=this.standardDeviation;return a};Cb.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;this.standardDeviation=a.standardDeviation;return this};Cb.prototype._updateCache=function(){var a=this._cache,b=this.midpoint,c=this.standardDeviation;if(b!==a.midpoint||c!==a.standardDeviation){var d=
c*c;a.midpoint=b;a.standardDeviation=c;a.variance=d;a.normalizationFactor=v(b,b,d)}return this};var Wb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=L.call(this,(b+c)/2)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(Wb,L);Wb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,d=this.right;return a>=c&&a<=b?a<=(c+b)/2?2*Math.pow((a-c)/(b-c),2):1-2*Math.pow((a-b)/(b-c),2):a>b&&a<=d?1:0};Wb.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);
a.midpoint=this.midpoint;return a};Wb.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var Db=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=L.call(this,(b+c)/2)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(Db,L);Db.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,d=this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=d?1:0};Db.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);
a.midpoint=this.midpoint;return a};Db.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var Eb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=L.call(this,b)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(Eb,L);Eb.prototype.computeDegreeOfMembership=function(a){var b=this.right;return a>=this.left&&a<=b?1:0};Eb.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};
Eb.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var Fb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=L.call(this,b)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(Fb,L);Fb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,d=this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=d?1/(d-b)*(d-a):0};Fb.prototype.toJSON=function(){var a=L.prototype.toJSON.call(this);a.midpoint=
this.midpoint;return a};Fb.prototype.fromJSON=function(a){L.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;return this};var Gb=function(a,b){this.antecedent=void 0===a?null:a;this.consequence=void 0===b?null:b};Gb.prototype.initConsequence=function(){this.consequence.clearDegreeOfMembership();return this};Gb.prototype.evaluate=function(){this.consequence.updateDegreeOfMembership(this.antecedent.getDegreeOfMembership());return this};Gb.prototype.toJSON=function(){var a={},b=this.antecedent,
c=this.consequence;a.type=this.constructor.name;a.antecedent=b instanceof ka?b.toJSON():b.uuid;a.consequence=c instanceof ka?c.toJSON():c.uuid;return a};Gb.prototype.fromJSON=function(a,b){function c(d){if("string"===typeof d)return b.get(d)||null;var e=d.type;switch(e){case "FuzzyAND":e=new Ic;break;case "FuzzyOR":e=new Jc;break;case "FuzzyVERY":e=new Ab;break;case "FuzzyFAIRLY":e=new zb;break;default:E.error("YUKA.FuzzyRule: Unsupported operator type:",e);return}d=d.terms;for(var f=0,g=d.length;f<
g;f++)e.terms.push(c(d[f]));return e}this.antecedent=c(a.antecedent);this.consequence=c(a.consequence);return this};var Sa=function(){this.fuzzySets=[];this.minRange=Infinity;this.maxRange=-Infinity};Sa.prototype.add=function(a){this.fuzzySets.push(a);a.left<this.minRange&&(this.minRange=a.left);a.right>this.maxRange&&(this.maxRange=a.right);return this};Sa.prototype.remove=function(a){var b=this.fuzzySets;a=b.indexOf(a);b.splice(a,1);this.minRange=Infinity;this.maxRange=-Infinity;a=0;for(var c=b.length;a<
c;a++){var d=b[a];d.left<this.minRange&&(this.minRange=d.left);d.right>this.maxRange&&(this.maxRange=d.right)}return this};Sa.prototype.fuzzify=function(a){if(a<this.minRange||a>this.maxRange)E.warn("YUKA.FuzzyVariable: Value for fuzzification out of range.");else{for(var b=this.fuzzySets,c=0,d=b.length;c<d;c++){var e=b[c];e.degreeOfMembership=e.computeDegreeOfMembership(a)}return this}};Sa.prototype.defuzzifyMaxAv=function(){for(var a=this.fuzzySets,b=0,c=0,d=0,e=a.length;d<e;d++){var f=a[d];b+=
f.degreeOfMembership;c+=f.representativeValue*f.degreeOfMembership}return 0===b?0:c/b};Sa.prototype.defuzzifyCentroid=function(a){a=void 0===a?10:a;for(var b=this.fuzzySets,c=(this.maxRange-this.minRange)/a,d=0,e=0,f=1;f<=a;f++)for(var g=this.minRange+f*c,k=0,m=b.length;k<m;k++){var n=b[k];n=Math.min(n.degreeOfMembership,n.computeDegreeOfMembership(g));d+=n;e+=g*n}return 0===d?0:e/d};Sa.prototype.toJSON=function(){for(var a={type:this.constructor.name,fuzzySets:[],minRange:this.minRange.toString(),
maxRange:this.maxRange.toString()},b=0,c=this.fuzzySets.length;b<c;b++)a.fuzzySets.push(this.fuzzySets[b].toJSON());return a};Sa.prototype.fromJSON=function(a){this.minRange=parseFloat(a.minRange);this.maxRange=parseFloat(a.maxRange);for(var b=0,c=a.fuzzySets.length;b<c;b++){var d=a.fuzzySets[b];switch(d.type){case "LeftShoulderFuzzySet":this.fuzzySets.push((new Bb).fromJSON(d));break;case "RightShoulderFuzzySet":this.fuzzySets.push((new Db).fromJSON(d));break;case "SingletonFuzzySet":this.fuzzySets.push((new Eb).fromJSON(d));
break;case "TriangularFuzzySet":this.fuzzySets.push((new Fb).fromJSON(d));break;default:E.error("YUKA.FuzzyVariable: Unsupported fuzzy set type:",d.type)}}return this};var qa=function(){this.rules=[];this.flvs=new Map};qa.prototype.addFLV=function(a,b){this.flvs.set(a,b);return this};qa.prototype.removeFLV=function(a){this.flvs.delete(a);return this};qa.prototype.addRule=function(a){this.rules.push(a);return this};qa.prototype.removeRule=function(a){var b=this.rules;a=b.indexOf(a);b.splice(a,1);return this};
qa.prototype.fuzzify=function(a,b){this.flvs.get(a).fuzzify(b);return this};qa.prototype.defuzzify=function(a,b){b=void 0===b?qa.DEFUZ_TYPE.MAXAV:b;var c=this.flvs,d=this.rules;this._initConsequences();for(var e=0,f=d.length;e<f;e++)d[e].evaluate();a=c.get(a);switch(b){case qa.DEFUZ_TYPE.MAXAV:b=a.defuzzifyMaxAv();break;case qa.DEFUZ_TYPE.CENTROID:b=a.defuzzifyCentroid();break;default:E.warn("YUKA.FuzzyModule: Unknown defuzzification method:",b),b=a.defuzzifyMaxAv()}return b};qa.prototype._initConsequences=
function(){for(var a=this.rules,b=0,c=a.length;b<c;b++)a[b].initConsequence();return this};qa.prototype.toJSON=function(){for(var a={rules:[],flvs:[]},b=this.rules,c=0,d=b.length;c<d;c++)a.rules.push(b[c].toJSON());b=$jscomp.makeIterator(this.flvs);for(c=b.next();!c.done;c=b.next())d=$jscomp.makeIterator(c.value),c=d.next().value,d=d.next().value,a.flvs.push({name:c,flv:d.toJSON()});return a};qa.prototype.fromJSON=function(a){for(var b=new Map,c=a.flvs,d=0,e=c.length;d<e;d++){var f=c[d],g=f.name;
f=(new Sa).fromJSON(f.flv);this.addFLV(g,f);g=$jscomp.makeIterator(f.fuzzySets);for(f=g.next();!f.done;f=g.next())f=f.value,b.set(f.uuid,f)}a=a.rules;c=0;for(d=a.length;c<d;c++)e=a[c],e=(new Gb).fromJSON(e,b),this.addRule(e);return this};qa.DEFUZ_TYPE=Object.freeze({MAXAV:0,CENTROID:1});var N=function(a){this.owner=void 0===a?null:a;this.status=N.STATUS.INACTIVE};N.prototype.activate=function(){};N.prototype.execute=function(){};N.prototype.terminate=function(){};N.prototype.handleMessage=function(){return!1};
N.prototype.active=function(){return this.status===N.STATUS.ACTIVE};N.prototype.inactive=function(){return this.status===N.STATUS.INACTIVE};N.prototype.completed=function(){return this.status===N.STATUS.COMPLETED};N.prototype.failed=function(){return this.status===N.STATUS.FAILED};N.prototype.replanIfFailed=function(){!0===this.failed()&&(this.status=N.STATUS.INACTIVE);return this};N.prototype.activateIfInactive=function(){!0===this.inactive()&&(this.status=N.STATUS.ACTIVE,this.activate());return this};
N.prototype.toJSON=function(){return{type:this.constructor.name,owner:this.owner.uuid,status:this.status}};N.prototype.fromJSON=function(a){this.owner=a.owner;this.status=a.status;return this};N.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;return this};N.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",COMPLETED:"completed",FAILED:"failed"});var la=function(a){a=N.call(this,void 0===a?null:a)||this;a.subgoals=[];return a};$jscomp.inherits(la,N);la.prototype.addSubgoal=
function(a){this.subgoals.unshift(a);return this};la.prototype.removeSubgoal=function(a){a=this.subgoals.indexOf(a);this.subgoals.splice(a,1);return this};la.prototype.clearSubgoals=function(){for(var a=this.subgoals,b=0,c=a.length;b<c;b++)a[b].terminate();a.length=0;return this};la.prototype.currentSubgoal=function(){var a=this.subgoals.length;return 0<a?this.subgoals[a-1]:null};la.prototype.executeSubgoals=function(){for(var a=this.subgoals,b=a.length-1;0<=b;b--){var c=a[b];if(!0===c.completed()||
!0===c.failed())c instanceof la&&c.clearSubgoals(),c.terminate(),a.pop();else break}b=this.currentSubgoal();return null!==b?(b.activateIfInactive(),b.execute(),!0===b.completed()&&1<a.length?N.STATUS.ACTIVE:b.status):N.STATUS.COMPLETED};la.prototype.hasSubgoals=function(){return 0<this.subgoals.length};la.prototype.handleMessage=function(a){var b=this.currentSubgoal();return null!==b?b.handleMessage(a):!1};la.prototype.toJSON=function(){var a=N.prototype.toJSON.call(this);a.subgoals=[];for(var b=
0,c=this.subgoals.length;b<c;b++)a.subgoals.push(this.subgoals[b].toJSON());return a};la.prototype.resolveReferences=function(a){N.prototype.resolveReferences.call(this,a);for(var b=0,c=this.subgoals.length;b<c;b++)this.subgoals[b].resolveReferences(a);return this};var Xb=function(a){this.characterBias=void 0===a?1:a};Xb.prototype.calculateDesirability=function(){return 0};Xb.prototype.setGoal=function(){};Xb.prototype.toJSON=function(){return{type:this.constructor.name,characterBias:this.characterBias}};
Xb.prototype.fromJSON=function(a){this.characterBias=a.characterBias;return this};var Fa=function(a){a=la.call(this,void 0===a?null:a)||this;a.evaluators=[];a._typesMap=new Map;return a};$jscomp.inherits(Fa,la);Fa.prototype.activate=function(){this.arbitrate()};Fa.prototype.execute=function(){this.activateIfInactive();var a=this.executeSubgoals();if(a===N.STATUS.COMPLETED||a===N.STATUS.FAILED)this.status=N.STATUS.INACTIVE};Fa.prototype.terminate=function(){this.clearSubgoals()};Fa.prototype.addEvaluator=
function(a){this.evaluators.push(a);return this};Fa.prototype.removeEvaluator=function(a){a=this.evaluators.indexOf(a);this.evaluators.splice(a,1);return this};Fa.prototype.arbitrate=function(){for(var a=this.evaluators,b=-1,c=null,d=0,e=a.length;d<e;d++){var f=a[d],g=f.calculateDesirability(this.owner);g*=f.characterBias;g>=b&&(b=g,c=f)}null!==c?c.setGoal(this.owner):E.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner);return this};Fa.prototype.toJSON=function(){var a=
la.prototype.toJSON.call(this);a.evaluators=[];for(var b=0,c=this.evaluators.length;b<c;b++)a.evaluators.push(this.evaluators[b].toJSON());return a};Fa.prototype.fromJSON=function(a){function b(m){var n=m.type,r=c.get(n);if(void 0!==r){n=(new r).fromJSON(m);m=m.subgoals;if(void 0!==m){r=0;for(var z=m.length;r<z;r++){var D=b(m[r]);D&&n.subgoals.push(D)}}return n}E.warn("YUKA.Think: Unsupported goal evaluator type:",n)}la.prototype.fromJSON.call(this,a);var c=this._typesMap;this.evaluators.length=0;
this.terminate();for(var d=0,e=a.evaluators.length;d<e;d++){var f=a.evaluators[d],g=f.type,k=c.get(g);void 0!==k?(f=(new k).fromJSON(f),this.evaluators.push(f)):E.warn("YUKA.Think: Unsupported goal evaluator type:",g)}d=0;for(e=a.subgoals.length;d<e;d++)(f=b(a.subgoals[d]))&&this.subgoals.push(f);return this};Fa.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};var La=function(a,b,c){this.from=void 0===a?-1:a;this.to=void 0===b?-1:b;this.cost=void 0===c?0:c};La.prototype.copy=
function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};La.prototype.clone=function(){return(new this.constructor).copy(this)};La.prototype.toJSON=function(){return{type:this.constructor.name,from:this.from,to:this.to,cost:this.cost}};La.prototype.fromJSON=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};var Hb=function(a){this.index=void 0===a?-1:a};Hb.prototype.toJSON=function(){return{type:this.constructor.name,index:this.index}};Hb.prototype.fromJSON=function(a){this.index=
a.index;return this};var fa=function(){this.digraph=!1;this._nodes=new Map;this._edges=new Map};fa.prototype.addNode=function(a){var b=a.index;this._nodes.set(b,a);this._edges.set(b,[]);return this};fa.prototype.addEdge=function(a){var b=this._edges.get(a.from);b.push(a);if(!1===this.digraph){var c=a.clone();c.from=a.to;c.to=a.from;b=this._edges.get(a.to);b.push(c)}return this};fa.prototype.getNode=function(a){return this._nodes.get(a)||null};fa.prototype.getEdge=function(a,b){if(this.hasNode(a)&&
this.hasNode(b)){a=this._edges.get(a);for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e.to===b)return e}}return null};fa.prototype.getNodes=function(a){a.length=0;a.push.apply(a,$jscomp.arrayFromIterable(this._nodes.values()));return a};fa.prototype.getEdgesOfNode=function(a,b){a=this._edges.get(a);void 0!==a&&(b.length=0,b.push.apply(b,$jscomp.arrayFromIterable(a)));return b};fa.prototype.getNodeCount=function(){return this._nodes.size};fa.prototype.getEdgeCount=function(){for(var a=0,b=$jscomp.makeIterator(this._edges.values()),
c=b.next();!c.done;c=b.next())a+=c.value.length;return a};fa.prototype.removeNode=function(a){this._nodes.delete(a.index);if(!1===this.digraph){var b=this._edges.get(a.index);b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=this._edges.get(c.value.to);for(var d=c.length-1;0<=d;d--){var e=c[d];if(e.to===a.index){d=c.indexOf(e);c.splice(d,1);break}}}}else for(b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())for(c=c.value,d=c.length-1;0<=d;d--)e=c[d],this.hasNode(e.to)&&
this.hasNode(e.from)||(e=c.indexOf(e),c.splice(e,1));this._edges.delete(a.index);return this};fa.prototype.removeEdge=function(a){var b=this._edges.get(a.from);if(void 0!==b){var c=b.indexOf(a);b.splice(c,1);if(!1===this.digraph){b=this._edges.get(a.to);c=0;for(var d=b.length;c<d;c++){var e=b[c];if(e.to===a.from){a=b.indexOf(e);b.splice(a,1);break}}}}return this};fa.prototype.hasNode=function(a){return this._nodes.has(a)};fa.prototype.hasEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);
for(var c=0,d=a.length;c<d;c++)if(a[c].to===b)return!0}return!1};fa.prototype.clear=function(){this._nodes.clear();this._edges.clear();return this};fa.prototype.toJSON=function(){for(var a={type:this.constructor.name,digraph:this.digraph},b=[],c=[],d=$jscomp.makeIterator(this._nodes.entries()),e=d.next();!e.done;e=d.next()){e=$jscomp.makeIterator(e.value);var f=e.next().value;e=e.next().value;var g=[];this.getEdgesOfNode(f,g);f=0;for(var k=g.length;f<k;f++)b.push(g[f].toJSON());c.push(e.toJSON())}a._edges=
b;a._nodes=c;return a};fa.prototype.fromJSON=function(a){this.digraph=a.digraph;for(var b=0,c=a._nodes.length;b<c;b++)this.addNode((new Hb).fromJSON(a._nodes[b]));b=0;for(c=a._edges.length;b<c;b++)this.addEdge((new La).fromJSON(a._edges[b]));return this};var qd=function(){};qd.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.distanceTo(a.position)};var ie=function(){};ie.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.squaredDistanceTo(a.position)};
var je=function(){};je.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.manhattanDistanceTo(a.position)};var ke=function(){};ke.calculate=function(){return 0};var Va=function(a){a=void 0===a?u:a;this.data=[];this.length=0;this.compare=a};Va.prototype.push=function(a){this.data.push(a);this.length++;this._up(this.length-1)};Va.prototype.pop=function(){if(0===this.length)return null;var a=this.data[0];this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));
this.data.pop();return a};Va.prototype.peek=function(){return this.data[0]||null};Va.prototype._up=function(a){for(var b=this.data,c=this.compare,d=b[a];0<a;){var e=a-1>>1,f=b[e];if(0<=c(d,f))break;b[a]=f;a=e}b[a]=d};Va.prototype._down=function(a){for(var b=this.data,c=this.compare,d=b[a],e=this.length>>1;a<e;){var f=(a<<1)+1,g=f+1,k=b[f];g<this.length&&0>c(b[g],k)&&(f=g,k=b[g]);if(0<=c(k,d))break;b[a]=k;a=f}b[a]=d};var Ib=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=
void 0===c?-1:c;this.found=!1;this.heuristic=qd;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};Ib.prototype.search=function(){var a=[],b=new Va(K);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var d=0,e=a.length;d<e;d++){var f=a[d],g=(this._cost.get(c)||
0)+f.cost,k=this.heuristic.calculate(this.graph,f.to,this.target);k=g+k;if(!1===this._searchFrontier.has(f.to)||g<this._cost.get(f.to))this._cost.set(f.to,g),this._searchFrontier.set(f.to,f),b.push({cost:k,index:f.to})}}}this.found=!1;return this};Ib.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};Ib.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};
Ib.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var Yb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};Yb.prototype.search=function(){var a=[],b=[],c=new La(this.source,this.source);a.push(c);for(this._visited.add(this.source);0<a.length;){var d=a.shift();this._route.set(d.to,
d.from);d!==c&&this._spanningTree.add(d);if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var e=b.length;d<e;d++){var f=b[d];!1===this._visited.has(f.to)&&(a.push(f),this._visited.add(f.to))}}this.found=!1;return this};Yb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};Yb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};
Yb.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};var Zb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};Zb.prototype.search=function(){var a=[],b=[],c=new La(this.source,this.source);for(a.push(c);0<a.length;){var d=a.pop();this._route.set(d.to,d.from);this._visited.add(d.to);d!==c&&this._spanningTree.add(d);
if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var e=b.length;d<e;d++){var f=b[d];!1===this._visited.has(f.to)&&a.push(f)}}this.found=!1;return this};Zb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};Zb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};Zb.prototype.clear=function(){this.found=
!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};var $b=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};$b.prototype.search=function(){var a=[],b=new Va(t);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,
this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var d=0,e=a.length;d<e;d++){var f=a[d],g=(this._cost.get(c)||0)+f.cost;if(!1===this._searchFrontier.has(f.to)||g<this._cost.get(f.to))this._cost.set(f.to,g),this._searchFrontier.set(f.to,f),b.push({cost:g,index:f.to})}}}this.found=!1;return this};$b.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,
a.unshift(b);return a};$b.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};$b.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var ea=new l,Jb=new l,Kb=new l,Ie=new l(1,0,0),Je=new l(0,1,0),Ke=new l(0,0,1),Wa={a:new l,b:new l,c:new l},le=new l,Lb=[],rd=function(a,b,c){this.branchingFactor=void 0===a?2:a;this.primitivesPerNode=void 0===b?1:b;this.depth=
void 0===c?10:c;this.root=null};rd.prototype.fromMeshGeometry=function(a){this.root=new xa;null!==a.indices&&(a=a.toTriangleSoup());a=a.vertices;for(var b=0,c=a.length;b<c;b++)this.root.primitives.push(a[b]);a=this.root.primitives;b=0;for(c=a.length;b<c;b+=9)ea.fromArray(a,b),Jb.fromArray(a,b+3),Kb.fromArray(a,b+6),ea.add(Jb).add(Kb).divideScalar(3),this.root.centroids.push(ea.x,ea.y,ea.z);this.root.build(this.branchingFactor,this.primitivesPerNode,this.depth,1);return this};rd.prototype.traverse=
function(a){this.root.traverse(a);return this};var xa=function(){this.parent=null;this.children=[];this.boundingVolume=new S;this.primitives=[];this.centroids=[]};xa.prototype.root=function(){return null===this.parent};xa.prototype.leaf=function(){return 0===this.children.length};xa.prototype.getDepth=function(){for(var a=0,b=this.parent;null!==b;)b=b.parent,a++;return a};xa.prototype.traverse=function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a);return this};
xa.prototype.build=function(a,b,c,d){this.computeBoundingVolume();var e=Math.floor(this.primitives.length/9/a);if(d<=c&&e>=b)for(this.split(a),e=0;e<a;e++)this.children[e].build(a,b,c,d+1);return this};xa.prototype.computeBoundingVolume=function(){var a=this.primitives,b=this.boundingVolume;b.min.set(Infinity,Infinity,Infinity);b.max.set(-Infinity,-Infinity,-Infinity);for(var c=0,d=a.length;c<d;c+=3)ea.x=a[c],ea.y=a[c+1],ea.z=a[c+2],b.expand(ea);return this};xa.prototype.computeSplitAxis=function(){for(var a,
b,c=b=a=-Infinity,d,e,f=e=d=Infinity,g=this.centroids,k=0,m=g.length;k<m;k+=3){var n=g[k],r=g[k+1],z=g[k+2];n>a&&(a=n);r>b&&(b=r);z>c&&(c=z);n<d&&(d=n);r<e&&(e=r);z<f&&(f=z)}a-=d;b-=e;c-=f;return a>b&&a>c?Ie:b>c?Je:Ke};xa.prototype.split=function(a){for(var b=this.centroids,c=this.primitives,d=0;d<a;d++)this.children[d]=new xa,this.children[d].parent=this;var e=this.computeSplitAxis();d=[];for(var f=0,g=b.length;f<g;f+=3){ea.fromArray(b,f);var k=ea.dot(e);d.push({index:f/3,p:k})}d.sort(B);e=d.length;
f=Math.floor(e/a);for(var m=k=g=0;m<e;m++){k++;k>f&&g<a-1&&(k=1,g++);var n=this.children[g],r=d[m].index,z=9*r;ea.fromArray(c,z);Jb.fromArray(c,z+3);Kb.fromArray(c,z+6);n.primitives.push(ea.x,ea.y,ea.z);n.primitives.push(Jb.x,Jb.y,Jb.z);n.primitives.push(Kb.x,Kb.y,Kb.z);ea.fromArray(b,3*r);n.centroids.push(ea.x,ea.y,ea.z)}this.centroids.length=0;this.primitives.length=0;return this};xa.prototype.intersectRay=function(a,b){if(null!==a.intersectAABB(this.boundingVolume,b))if(!0===this.leaf())for(var c=
this.primitives,d=0,e=c.length;d<e;d+=9)Wa.a.fromArray(c,d),Wa.b.fromArray(c,d+3),Wa.c.fromArray(c,d+6),null!==a.intersectTriangle(Wa,!0,b)&&Lb.push(b.clone());else for(c=0,d=this.children.length;c<d;c++)this.children[c].intersectRay(a,b);if(!0===this.root()&&0<Lb.length){c=Infinity;d=0;for(e=Lb.length;d<e;d++){var f=a.origin.squaredDistanceTo(Lb[d]);f<c&&(c=f,b.copy(Lb[d]))}Lb.length=0;return b}return null};xa.prototype.intersectsRay=function(a){if(null!==a.intersectAABB(this.boundingVolume,le))if(!0===
this.leaf())for(var b=this.primitives,c=0,d=b.length;c<d;c+=9){if(Wa.a.fromArray(b,c),Wa.b.fromArray(b,c+3),Wa.c.fromArray(b,c+6),null!==a.intersectTriangle(Wa,!0,le))return!0}else for(b=0,c=this.children.length;b<c;b++)if(!0===this.children[b].intersectsRay(a))return!0;return!1};var me=new l,Kc=new l,Ba=function(a,b){a=void 0===a?new l:a;b=void 0===b?new l:b;this.from=a;this.to=b};Ba.prototype.set=function(a,b){this.from=a;this.to=b;return this};Ba.prototype.copy=function(a){this.from.copy(a.from);
this.to.copy(a.to);return this};Ba.prototype.clone=function(){return(new this.constructor).copy(this)};Ba.prototype.delta=function(a){return a.subVectors(this.to,this.from)};Ba.prototype.at=function(a,b){return this.delta(b).multiplyScalar(a).add(this.from)};Ba.prototype.closestPointToPoint=function(a,b,c){a=this.closestPointToPointParameter(a,b);return this.at(a,c)};Ba.prototype.closestPointToPointParameter=function(a,b){b=void 0===b?!0:b;me.subVectors(a,this.from);Kc.subVectors(this.to,this.from);
a=Kc.dot(Kc);a=Kc.dot(me)/a;b&&(a=T.clamp(a,0,1));return a};Ba.prototype.equals=function(a){return a.from.equals(this.from)&&a.to.equals(this.to)};var Lc=new l,ne=new l,sd=new l,td=new l,ud=new l,vd=new l,oe=new l,Xa=function(){};Xa.prototype.intersects=function(a,b){return this._checkFaceDirections(a,b)||this._checkFaceDirections(b,a)||this._checkEdgeDirections(a,b)?!1:!0};Xa.prototype._checkFaceDirections=function(a,b){a=a.faces;for(var c=0,d=a.length;c<d;c++){var e=a[c].plane;ne.copy(e.normal).multiplyScalar(-1);
var f=this._getSupportVertex(b,ne);if(0<e.distanceToPoint(f))return!0}return!1};Xa.prototype._checkEdgeDirections=function(a,b){var c=a.edges;b=b.edges;for(var d=0,e=c.length;d<e;d++)for(var f=c[d],g=0,k=b.length;g<k;g++){var m=b[g];f.getDirection(sd);m.getDirection(td);if(this._minkowskiFace(f,sd,m,td)&&0<this._distanceBetweenEdges(f,sd,m,td,a))return!0}return!1};Xa.prototype._getSupportVertex=function(a,b){var c=-Infinity,d=null;a=a.vertices;for(var e=0,f=a.length;e<f;e++){var g=a[e],k=g.dot(b);
k>c&&(c=k,d=g)}return d};Xa.prototype._minkowskiFace=function(a,b,c,d){var e=a.polygon.plane.normal;a=a.twin.polygon.plane.normal;ud.copy(c.polygon.plane.normal);vd.copy(c.twin.polygon.plane.normal);ud.multiplyScalar(-1);vd.multiplyScalar(-1);c=ud.dot(b);b=vd.dot(b);e=e.dot(d);d=a.dot(d);return 0>c*b&&0>e*d&&0<c*d};Xa.prototype._distanceBetweenEdges=function(a,b,c,d,e){if(1===Math.abs(b.dot(d)))return-Infinity;Lc.crossVectors(b,d).normalize();0>Lc.dot(oe.subVectors(a.vertex,e.centroid))&&Lc.multiplyScalar(-1);
return Lc.dot(oe.subVectors(c.vertex,a.vertex))};var Ya=function(a){this.vertex=a=void 0===a?new l:a;this.polygon=this.twin=this.prev=this.next=null};Ya.prototype.tail=function(){return this.prev?this.prev.vertex:null};Ya.prototype.head=function(){return this.vertex};Ya.prototype.length=function(){var a=this.tail(),b=this.head();return null!==a?a.distanceTo(b):-1};Ya.prototype.squaredLength=function(){var a=this.tail(),b=this.head();return null!==a?a.squaredDistanceTo(b):-1};Ya.prototype.linkOpponent=
function(a){this.twin=a;a.twin=this;return this};Ya.prototype.getDirection=function(a){return a.subVectors(this.vertex,this.prev.vertex).normalize()};var ha=function(){this.centroid=new l;this.edge=null;this.plane=new na};ha.prototype.fromContour=function(a){var b=[];if(3>a.length)return E.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(var c=0,d=a.length;c<d;c++){var e=new Ya(a[c]);b.push(e)}c=0;for(d=b.length;c<d;c++){if(0===c){e=b[c];var f=
b[d-1];var g=b[c+1]}else c===d-1?(e=b[c],f=b[c-1],g=b[0]):(e=b[c],f=b[c-1],g=b[c+1]);e.prev=f;e.next=g;e.polygon=this}this.edge=b[0];this.plane.fromCoplanarPoints(a[0],a[1],a[2]);return this};ha.prototype.computeCentroid=function(){var a=this.centroid,b=this.edge,c=0;a.set(0,0,0);do a.add(b.vertex),c++,b=b.next;while(b!==this.edge);a.divideScalar(c);return this};ha.prototype.contains=function(a,b){b=void 0===b?.001:b;var c=this.plane,d=this.edge;do{var e=d.tail(),f=d.head();if(!1===0<=T.area(e,f,
a))return!1;d=d.next}while(d!==this.edge);a=c.distanceToPoint(a);return Math.abs(a)>b?!1:!0};ha.prototype.convex=function(a){a=void 0===a?!0:a;var b=this.edge;do{var c=b.tail(),d=b.head(),e=b.next.head();if(a){if(!1===0<=T.area(c,d,e))return!1}else if(!1===0<=T.area(e,d,c))return!1;b=b.next}while(b!==this.edge);return!0};ha.prototype.coplanar=function(a){a=void 0===a?.001:a;var b=this.plane,c=this.edge;do{var d=b.distanceToPoint(c.vertex);if(Math.abs(d)>a)return!1;c=c.next}while(c!==this.edge);return!0};
ha.prototype.distanceToPoint=function(a){return this.plane.distanceToPoint(a)};ha.prototype.getContour=function(a){var b=this.edge;a.length=0;do a.push(b.vertex),b=b.next;while(b!==this.edge);return a};var Za=function(){this.faces=[];this.edges=[];this.vertices=[];this.centroid=new l};Za.prototype.computeCentroid=function(){var a=this.centroid,b=this.faces;a.set(0,0,0);for(var c=0,d=b.length;c<d;c++)a.add(b[c].centroid);a.divideScalar(b.length);return this};Za.prototype.computeUniqueVertices=function(){var a=
this.faces,b=this.vertices;b.length=0;for(var c=new Set,d=0,e=a.length;d<e;d++){var f=a[d],g=f.edge;do c.add(g.vertex),g=g.next;while(g!==f.edge)}b.push.apply(b,$jscomp.arrayFromIterable(c));return this};Za.prototype.computeUniqueEdges=function(){for(var a=this.faces,b=this.edges,c=b.length=0,d=a.length;c<d;c++){var e=a[c],f=e.edge;do!1===b.includes(f.twin)&&b.push(f),f=f.next;while(f!==e.edge)}return this};Za.prototype.fromAABB=function(a){this.faces.length=0;this.vertices.length=0;var b=a.min,c=
a.max,d=[new l(c.x,c.y,c.z),new l(c.x,c.y,b.z),new l(c.x,b.y,c.z),new l(c.x,b.y,b.z),new l(b.x,c.y,c.z),new l(b.x,c.y,b.z),new l(b.x,b.y,c.z),new l(b.x,b.y,b.z)];this.vertices.push.apply(this.vertices,$jscomp.arrayFromIterable(d));b=(new ha).fromContour([d[4],d[0],d[1],d[5]]);c=(new ha).fromContour([d[2],d[3],d[1],d[0]]);var e=(new ha).fromContour([d[6],d[2],d[0],d[4]]),f=(new ha).fromContour([d[3],d[7],d[5],d[1]]),g=(new ha).fromContour([d[3],d[2],d[6],d[7]]);d=(new ha).fromContour([d[7],d[6],d[4],
d[5]]);b.edge.linkOpponent(d.edge.prev);b.edge.next.linkOpponent(e.edge.prev);b.edge.next.next.linkOpponent(c.edge.prev);b.edge.prev.linkOpponent(f.edge.prev);g.edge.linkOpponent(f.edge.next);g.edge.next.linkOpponent(c.edge.next);g.edge.next.next.linkOpponent(e.edge.next);g.edge.prev.linkOpponent(d.edge.next);d.edge.linkOpponent(f.edge.next.next);f.edge.linkOpponent(c.edge.next.next);c.edge.linkOpponent(e.edge.next.next);e.edge.linkOpponent(d.edge.next.next);this.faces.push(b,c,e,f,g,d);b.computeCentroid();
c.computeCentroid();e.computeCentroid();f.computeCentroid();g.computeCentroid();d.computeCentroid();a.getCenter(this.centroid);this.computeUniqueEdges();return this};var pe=new Ba,Mc=new na,qe=new l,Le=new l(0,1,0),re=new Xa,ac,Z=function(){var a=Za.call(this)||this;a.mergeFaces=!0;a._tolerance=-1;a._vertices=[];a._assigned=new Ca;a._unassigned=new Ca;return a};$jscomp.inherits(Z,Za);Z.prototype.containsPoint=function(a){for(var b=this.faces,c=0,d=b.length;c<d;c++)if(b[c].distanceToPoint(a)>this._tolerance)return!1;
return!0};Z.prototype.intersectsAABB=function(a){if(void 0===ac)ac=(new Za).fromAABB(a);else{var b=a.min,c=a.max,d=ac.vertices;d[0].set(c.x,c.y,c.z);d[1].set(c.x,c.y,b.z);d[2].set(c.x,b.y,c.z);d[3].set(c.x,b.y,b.z);d[4].set(b.x,c.y,c.z);d[5].set(b.x,c.y,b.z);d[6].set(b.x,b.y,c.z);d[7].set(b.x,b.y,b.z);a.getCenter(ac.centroid)}return re.intersects(this,ac)};Z.prototype.intersectsConvexHull=function(a){return re.intersects(this,a)};Z.prototype.fromPoints=function(a){if(4>a.length)return E.error("YUKA.ConvexHull: The given points array needs at least four points."),
this;for(var b=0,c=a.length;b<c;b++)this._vertices.push(new se(a[b]));this._generate();return this};Z.prototype._addAdjoiningFace=function(a,b){a=new Da(a.point,b.prev.vertex,b.vertex);this.faces.push(a);a.getEdge(-1).linkOpponent(b.twin);return a.getEdge(0)};Z.prototype._addNewFaces=function(a,b){for(var c=[],d=null,e=null,f=0,g=b.length;f<g;f++){var k=this._addAdjoiningFace(a,b[f]);null===d?d=k:k.next.linkOpponent(e);c.push(k.polygon);e=k}d.next.linkOpponent(e);return c};Z.prototype._addVertexToFace=
function(a,b){a.face=b;null===b.outside?(this._assigned.append(a),b.outside=a):this._assigned.insertAfter(b.outside,a);return this};Z.prototype._addVertexToHull=function(a){var b=[];this._unassigned.clear();this._computeHorizon(a.point,null,a.face,b);a=this._addNewFaces(a,b);this._resolveUnassignedPoints(a);return this};Z.prototype._reset=function(){this._vertices.length=0;this._assigned.clear();this._unassigned.clear();return this};Z.prototype._computeInitialHull=function(){var a=this._vertices;
var b=this._computeExtremes();var c=b.min,d=b.max;var e=d.x.point.x-c.x.point.x;b=c.x;var f=d.x;var g=d.y.point.y-c.y.point.y;g>e&&(b=c.y,f=d.y,e=g);g=d.z.point.z-c.z.point.z;g>e&&(b=c.z,f=d.z);e=-Infinity;pe.set(b.point,f.point);c=0;for(d=a.length;c<d;c++){var k=a[c];if(k!==b&&k!==f&&(pe.closestPointToPoint(k.point,!0,qe),g=qe.squaredDistanceTo(k.point),g>e)){e=g;var m=k}}e=-Infinity;Mc.fromCoplanarPoints(b.point,f.point,m.point);c=0;for(d=a.length;c<d;c++)if(k=a[c],k!==b&&k!==f&&k!==m&&(g=Math.abs(Mc.distanceToPoint(k.point)),
g>e)){e=g;var n=k}if(0===Mc.distanceToPoint(n.point))throw"ERROR: YUKA.ConvexHull: All extreme points lie in a single plane. Unable to compute convex hull.";c=this.faces;0>Mc.distanceToPoint(n.point)?(c.push(new Da(b.point,f.point,m.point),new Da(n.point,f.point,b.point),new Da(n.point,m.point,f.point),new Da(n.point,b.point,m.point)),c[1].getEdge(2).linkOpponent(c[0].getEdge(1)),c[2].getEdge(2).linkOpponent(c[0].getEdge(2)),c[3].getEdge(2).linkOpponent(c[0].getEdge(0)),c[1].getEdge(1).linkOpponent(c[2].getEdge(0)),
c[2].getEdge(1).linkOpponent(c[3].getEdge(0)),c[3].getEdge(1).linkOpponent(c[1].getEdge(0))):(c.push(new Da(b.point,m.point,f.point),new Da(n.point,b.point,f.point),new Da(n.point,f.point,m.point),new Da(n.point,m.point,b.point)),c[1].getEdge(2).linkOpponent(c[0].getEdge(0)),c[2].getEdge(2).linkOpponent(c[0].getEdge(2)),c[3].getEdge(2).linkOpponent(c[0].getEdge(1)),c[1].getEdge(0).linkOpponent(c[2].getEdge(1)),c[2].getEdge(0).linkOpponent(c[3].getEdge(1)),c[3].getEdge(0).linkOpponent(c[1].getEdge(1)));
d=0;for(k=a.length;d<k;d++){var r=a[d];if(r!==b&&r!==f&&r!==m&&r!==n){e=this._tolerance;for(var z=null,D=0;4>D;D++)g=c[D].distanceToPoint(r.point),g>e&&(e=g,z=c[D]);null!==z&&this._addVertexToFace(r,z)}}return this};Z.prototype._computeExtremes=function(){for(var a=new l(Infinity,Infinity,Infinity),b=new l(-Infinity,-Infinity,-Infinity),c={x:null,y:null,z:null},d={x:null,y:null,z:null},e=0,f=this._vertices.length;e<f;e++){var g=this._vertices[e],k=g.point;k.x<a.x&&(a.x=k.x,c.x=g);k.y<a.y&&(a.y=k.y,
c.y=g);k.z<a.z&&(a.z=k.z,c.z=g);k.x>b.x&&(b.x=k.x,d.x=g);k.y>b.y&&(b.y=k.y,d.y=g);k.z>b.z&&(b.z=k.z,d.z=g)}this._tolerance=3*Number.EPSILON*(Math.max(Math.abs(a.x),Math.abs(b.x))+Math.max(Math.abs(a.y),Math.abs(b.y))+Math.max(Math.abs(a.z),Math.abs(b.z)));return{min:c,max:d}};Z.prototype._computeHorizon=function(a,b,c,d){if(c.outside){var e=c.outside;this._removeAllVerticesFromFace(c);this._unassigned.appendChain(e)}c.active=!1;c=null===b?b=c.getEdge(0):b.next;do{e=c.twin;var f=e.polygon;f.active&&
(f.distanceToPoint(a)>this._tolerance?this._computeHorizon(a,e,f,d):d.push(c));c=c.next}while(c!==b);return this};Z.prototype._generate=function(){this.faces.length=0;this._computeInitialHull();for(var a;a=this._nextVertexToAdd();)this._addVertexToHull(a);this._updateFaces();this._postprocessHull();this._reset();return this};Z.prototype._postprocessHull=function(){var a=this.faces,b=this.edges;if(!0===this.mergeFaces){this.computeUniqueEdges();b.sort(function(D,J){return J.length()-D.length()});for(var c=
0,d=b.length;c<d;c++){var e=b[c];if(!1!==this._mergePossible(e)){var f=e;var g=f.prev;var k=f.next;var m=f.twin.prev;var n=f.twin.next;f.prev.next=f.twin.next;f.next.prev=f.twin.prev;f.twin.prev.next=f.next;f.twin.next.prev=f.prev;var r=f.polygon;r.edge=f.prev;var z=0<=r.plane.normal.dot(Le);if(!0===r.convex(z)&&!0===r.coplanar(this._tolerance)){g=r.edge;do g.polygon=r,g=g.next;while(g!==r.edge);e=a.indexOf(e.twin.polygon);a.splice(e,1)}else g.next=f,k.prev=f,m.next=f.twin,n.prev=f.twin,r.edge=f}}b=
0;for(c=a.length;b<c;b++)a[b].computeCentroid()}this.computeCentroid();this.computeUniqueEdges();this.computeUniqueVertices();return this};Z.prototype._mergePossible=function(a){var b=a.polygon,c=a.twin;do{if(c!==a.twin&&c.twin.polygon===b)return!1;c=c.next}while(a.twin!==c);return!0};Z.prototype._nextVertexToAdd=function(){var a=null;if(!1===this._assigned.empty()){var b=0,c=this._assigned.first(),d=c.face;do{var e=d.distanceToPoint(c.point);e>b&&(b=e,a=c);c=c.next}while(null!==c&&c.face===d)}return a};
Z.prototype._updateFaces=function(){for(var a=this.faces,b=[],c=0,d=a.length;c<d;c++){var e=a[c];e.active&&b.push(e)}this.faces.length=0;this.faces.push.apply(this.faces,$jscomp.arrayFromIterable(b));return this};Z.prototype._removeAllVerticesFromFace=function(a){if(null!==a.outside){var b=a.outside;b.face=null;for(var c=a.outside;null!==c.next&&c.next.face===a;)c=c.next,c.face=null;a.outside=null;this._assigned.removeChain(b,c)}return this};Z.prototype._removeVertexFromFace=function(a,b){a.face=
null;a===b.outside&&(b.outside=null!==a.next&&a.next.face===b?a.next:null);this._assigned.remove(a);return this};Z.prototype._resolveUnassignedPoints=function(a){if(!1===this._unassigned.empty()){var b=this._unassigned.first();do{for(var c=b.next,d=this._tolerance,e=null,f=0,g=a.length;f<g;f++){var k=a[f];if(k.active){var m=k.distanceToPoint(b.point);m>d&&(d=m,e=k)}}null!==e&&this._addVertexToFace(b,e);b=c}while(null!==b)}return this};var Da=function(a,b,c){a=void 0===a?new l:a;b=void 0===b?new l:
b;c=void 0===c?new l:c;var d=ha.call(this)||this;d.outside=null;d.active=!0;d.fromContour([a,b,c]);d.computeCentroid();return d};$jscomp.inherits(Da,ha);Da.prototype.getEdge=function(a){for(var b=this.edge;0<a;)b=b.next,a--;for(;0>a;)b=b.prev,a++;return b};var se=function(a){this.point=a=void 0===a?new l:a;this.face=this.next=this.prev=null},Ca=function(){this.tail=this.head=null};Ca.prototype.first=function(){return this.head};Ca.prototype.last=function(){return this.tail};Ca.prototype.clear=function(){this.head=
this.tail=null;return this};Ca.prototype.insertAfter=function(a,b){b.prev=a;b.next=a.next;b.next?b.next.prev=b:this.tail=b;a.next=b;return this};Ca.prototype.append=function(a){null===this.head?this.head=a:this.tail.next=a;a.prev=this.tail;a.next=null;this.tail=a;return this};Ca.prototype.appendChain=function(a){null===this.head?this.head=a:this.tail.next=a;for(a.prev=this.tail;null!==a.next;)a=a.next;this.tail=a;return this};Ca.prototype.remove=function(a){null===a.prev?this.head=a.next:a.prev.next=
a.next;null===a.next?this.tail=a.prev:a.next.prev=a.prev;a.prev=null;a.next=null;return this};Ca.prototype.removeChain=function(a,b){null===a.prev?this.head=b.next:a.prev.next=b.next;null===b.next?this.tail=a.prev:b.next.prev=a.prev;a.prev=null;b.next=null;return this};Ca.prototype.empty=function(){return null===this.head};var te={unitary:new O,diagonal:new O},ue=null,mb=[new l,new l,new l],U=[],ve=null,Nc=[new l,new l,new l],V=[],aa=[[],[],[]],I=[[],[],[]],W=[],nb=new l,ob=new l,pb=new l,Ea=new l,
we=new l,ia=function(a,b,c){a=void 0===a?new l:a;b=void 0===b?new l:b;c=void 0===c?new O:c;this.center=a;this.halfSizes=b;this.rotation=c};ia.prototype.set=function(a,b,c){this.center=a;this.halfSizes=b;this.rotation=c;return this};ia.prototype.copy=function(a){this.center.copy(a.center);this.halfSizes.copy(a.halfSizes);this.rotation.copy(a.rotation);return this};ia.prototype.clone=function(){return(new this.constructor).copy(this)};ia.prototype.getSize=function(a){return a.copy(this.halfSizes).multiplyScalar(2)};
ia.prototype.clampPoint=function(a,b){var c=this.halfSizes;Ea.subVectors(a,this.center);this.rotation.extractBasis(nb,ob,pb);b.copy(this.center);a=T.clamp(Ea.dot(nb),-c.x,c.x);b.add(nb.multiplyScalar(a));a=T.clamp(Ea.dot(ob),-c.y,c.y);b.add(ob.multiplyScalar(a));c=T.clamp(Ea.dot(pb),-c.z,c.z);b.add(pb.multiplyScalar(c));return b};ia.prototype.containsPoint=function(a){Ea.subVectors(a,this.center);this.rotation.extractBasis(nb,ob,pb);return Math.abs(Ea.dot(nb))<=this.halfSizes.x&&Math.abs(Ea.dot(ob))<=
this.halfSizes.y&&Math.abs(Ea.dot(pb))<=this.halfSizes.z};ia.prototype.intersectsAABB=function(a){return this.intersectsOBB(Me.fromAABB(a))};ia.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,we);return we.squaredDistanceTo(a.center)<=a.radius*a.radius};ia.prototype.intersectsOBB=function(a,b){b=void 0===b?Number.EPSILON:b;ue=this.center;U[0]=this.halfSizes.x;U[1]=this.halfSizes.y;U[2]=this.halfSizes.z;this.rotation.extractBasis(mb[0],mb[1],mb[2]);ve=a.center;V[0]=a.halfSizes.x;
V[1]=a.halfSizes.y;V[2]=a.halfSizes.z;a.rotation.extractBasis(Nc[0],Nc[1],Nc[2]);for(a=0;3>a;a++)for(var c=0;3>c;c++)aa[a][c]=mb[a].dot(Nc[c]);Ea.subVectors(ve,ue);W[0]=Ea.dot(mb[0]);W[1]=Ea.dot(mb[1]);W[2]=Ea.dot(mb[2]);for(a=0;3>a;a++)for(c=0;3>c;c++)I[a][c]=Math.abs(aa[a][c])+b;for(c=0;3>c;c++)if(b=U[c],a=V[0]*I[c][0]+V[1]*I[c][1]+V[2]*I[c][2],Math.abs(W[c])>b+a)return!1;for(c=0;3>c;c++)if(b=U[0]*I[0][c]+U[1]*I[1][c]+U[2]*I[2][c],a=V[c],Math.abs(W[0]*aa[0][c]+W[1]*aa[1][c]+W[2]*aa[2][c])>b+a)return!1;
b=U[1]*I[2][0]+U[2]*I[1][0];a=V[1]*I[0][2]+V[2]*I[0][1];if(Math.abs(W[2]*aa[1][0]-W[1]*aa[2][0])>b+a)return!1;b=U[1]*I[2][1]+U[2]*I[1][1];a=V[0]*I[0][2]+V[2]*I[0][0];if(Math.abs(W[2]*aa[1][1]-W[1]*aa[2][1])>b+a)return!1;b=U[1]*I[2][2]+U[2]*I[1][2];a=V[0]*I[0][1]+V[1]*I[0][0];if(Math.abs(W[2]*aa[1][2]-W[1]*aa[2][2])>b+a)return!1;b=U[0]*I[2][0]+U[2]*I[0][0];a=V[1]*I[1][2]+V[2]*I[1][1];if(Math.abs(W[0]*aa[2][0]-W[2]*aa[0][0])>b+a)return!1;b=U[0]*I[2][1]+U[2]*I[0][1];a=V[0]*I[1][2]+V[2]*I[1][0];if(Math.abs(W[0]*
aa[2][1]-W[2]*aa[0][1])>b+a)return!1;b=U[0]*I[2][2]+U[2]*I[0][2];a=V[0]*I[1][1]+V[1]*I[1][0];if(Math.abs(W[0]*aa[2][2]-W[2]*aa[0][2])>b+a)return!1;b=U[0]*I[1][0]+U[1]*I[0][0];a=V[1]*I[2][2]+V[2]*I[2][1];if(Math.abs(W[1]*aa[0][0]-W[0]*aa[1][0])>b+a)return!1;b=U[0]*I[1][1]+U[1]*I[0][1];a=V[0]*I[2][2]+V[2]*I[2][0];if(Math.abs(W[1]*aa[0][1]-W[0]*aa[1][1])>b+a)return!1;b=U[0]*I[1][2]+U[1]*I[0][2];a=V[0]*I[2][1]+V[1]*I[2][0];return Math.abs(W[1]*aa[0][2]-W[0]*aa[1][2])>b+a?!1:!0};ia.prototype.intersectsPlane=
function(a){this.rotation.extractBasis(nb,ob,pb);var b=this.halfSizes.x*Math.abs(a.normal.dot(nb))+this.halfSizes.y*Math.abs(a.normal.dot(ob))+this.halfSizes.z*Math.abs(a.normal.dot(pb));a=a.normal.dot(this.center)-a.constant;return Math.abs(a)<=b};ia.prototype.fromAABB=function(a){a.getCenter(this.center);a.getSize(this.halfSizes).multiplyScalar(.5);this.rotation.identity();return this};ia.prototype.fromPoints=function(a){for(var b=(new Z).fromPoints(a).faces,c=[],d=[],e=0,f=b.length;e<f;e++){var g=
b[e],k=g.edge;c.length=0;do c.push(k),k=k.next;while(k!==g.edge);g=1;for(k=c.length-2;g<=k;g++){var m=c[0].vertex,n=c[g+0].vertex,r=c[g+1].vertex;d.push(m.x,m.y,m.z);d.push(n.x,n.y,n.z);d.push(r.x,r.y,r.z)}}m=new l;n=new l;r=new l;for(var z=new l,D=new l,J=new l,F=new l,G=new l,C=0,M=b=c=e=f=g=k=0,sa=d.length;M<sa;M+=9){m.fromArray(d,M);n.fromArray(d,M+3);r.fromArray(d,M+6);F.set(0,0,0);F.add(m).add(n).add(r).divideScalar(3);z.subVectors(n,m);D.subVectors(r,m);var ja=J.crossVectors(z,D).length()/
2;G.add(J.copy(F).multiplyScalar(ja));C+=ja;b+=ja/12*(9*F.x*F.x+m.x*m.x+n.x*n.x+r.x*r.x);c+=ja/12*(9*F.x*F.y+m.x*m.y+n.x*n.y+r.x*r.y);e+=ja/12*(9*F.x*F.z+m.x*m.z+n.x*n.z+r.x*r.z);f+=ja/12*(9*F.y*F.y+m.y*m.y+n.y*n.y+r.y*r.y);g+=ja/12*(9*F.y*F.z+m.y*m.z+n.y*n.z+r.y*r.z);k+=ja/12*(9*F.z*F.z+m.z*m.z+n.z*n.z+r.z*r.z)}G.divideScalar(C);b=b/C-G.x*G.x;c=c/C-G.x*G.y;e=e/C-G.x*G.z;f=f/C-G.y*G.y;g=g/C-G.y*G.z;k=k/C-G.z*G.z;d=new O;d.elements[0]=b;d.elements[1]=c;d.elements[2]=e;d.elements[3]=c;d.elements[4]=
f;d.elements[5]=g;d.elements[6]=e;d.elements[7]=g;d.elements[8]=k;d.eigenDecomposition(te);d=te.unitary;b=new l;c=new l;e=new l;d.extractBasis(b,c,e);k=g=f=-Infinity;r=n=m=Infinity;z=0;for(D=a.length;z<D;z++)J=a[z],f=Math.max(b.dot(J),f),g=Math.max(c.dot(J),g),k=Math.max(e.dot(J),k),m=Math.min(b.dot(J),m),n=Math.min(c.dot(J),n),r=Math.min(e.dot(J),r);b.multiplyScalar(.5*(m+f));c.multiplyScalar(.5*(n+g));e.multiplyScalar(.5*(r+k));this.center.add(b).add(c).add(e);this.halfSizes.x=f-m;this.halfSizes.y=
g-n;this.halfSizes.z=k-r;this.halfSizes.multiplyScalar(.5);this.rotation.copy(d);return this};ia.prototype.equals=function(a){return a.center.equals(this.center)&&a.halfSizes.equals(this.halfSizes)&&a.rotation.equals(this.rotation)};ia.prototype.toJSON=function(){return{type:this.constructor.name,center:this.center.toArray([]),halfSizes:this.halfSizes.toArray([]),rotation:this.rotation.toArray([])}};ia.prototype.fromJSON=function(a){this.center.fromArray(a.center);this.halfSizes.fromArray(a.halfSizes);
this.rotation.fromArray(a.rotation);return this};var Me=new ia,Oc=function(a,b,c){return La.call(this,void 0===a?-1:a,void 0===b?-1:b,void 0===c?0:c)||this};$jscomp.inherits(Oc,La);var Pc=function(a,b,c){a=void 0===a?-1:a;b=void 0===b?new l:b;c=void 0===c?{}:c;a=Hb.call(this,a)||this;a.position=b;a.userData=c;return a};$jscomp.inherits(Pc,Hb);var xe=function(){};xe.createGridLayout=function(a,b){var c=new fa;c.digraph=!0;var d=a/2;a/=b;for(var e=0,f=0;f<=b;f++)for(var g=f*a-d,k=0;k<=b;k++){var m=
new l(k*a-d,0,g);m=new Pc(e,m);c.addNode(m);e++}b=c.getNodeCount();d=Math.pow(a+a/2,2);for(a=0;a<b;a++)for(e=c.getNode(a),f=0;f<b;f++)a!==f&&(g=c.getNode(f).position.squaredDistanceTo(e.position),g<=d&&(g=new Oc(a,f,Math.sqrt(g)),c.addEdge(g)));return c};var Qc=function(){this.portalEdges=[]};Qc.prototype.push=function(a,b){this.portalEdges.push({left:a,right:b});return this};Qc.prototype.generate=function(){var a=this.portalEdges,b=[],c=0,d=0;var e=a[0].left;var f=a[0].left;var g=a[0].right;b.push(e);
var k=1;for(var m=a.length;k<m;k++){var n=a[k].left,r=a[k].right;if(0>=T.area(e,g,r))if(e===g||0<T.area(e,f,r))g=r,d=k;else{b.push(f);e=f;k=c;g=f=e;d=c=k;continue}0<=T.area(e,f,n)&&(e===f||0>T.area(e,g,n)?(f=n,c=k):(b.push(g),e=g,k=d,g=f=e,d=c=k))}0!==b.length&&b[b.length-1]===a[a.length-1].left||b.push(a[a.length-1].left);return b};var $a=function(){this._nodeMap=new Map};$a.prototype.init=function(a){var b=a.graph,c=[];this.clear();b.getNodes(c);b=0;for(var d=c.length;b<d;b++)for(var e=c[b],f=0,
g=c.length;f<g;f++){for(var k=c[f],m=a.findPath(e.position,k.position),n=0,r=0,z=m.length-1;r<z;r++)n+=m[r].distanceTo(m[r+1]);this.set(e.index,k.index,n)}return this};$a.prototype.clear=function(){this._nodeMap.clear();return this};$a.prototype.set=function(a,b,c){var d=this._nodeMap;!1===d.has(a)&&d.set(a,new Map);d.get(a).set(b,c);return this};$a.prototype.get=function(a,b){return this._nodeMap.get(a).get(b)};$a.prototype.size=function(){return this._nodeMap.size};$a.prototype.toJSON=function(){for(var a=
{nodes:[]},b=$jscomp.makeIterator(this._nodeMap.entries()),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;a.nodes.push({index:c,costs:Array.from(d)})}return a};$a.prototype.fromJSON=function(a){a=a.nodes;for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.index;d=new Map(d.costs);this._nodeMap.set(e,d)}return this};var wd=new l,xd=new l,yd=new l,bc=new l,cc=new Ba,zd=[],Ad={edge:null,closestPoint:new l},ma=function(){this.graph=new fa;this.graph.digraph=
!0;this.regions=[];this.spatialIndex=null;this.epsilonCoplanarTest=.001;this.epsilonContainsTest=1;this.mergeConvexRegions=!0;this._borderEdges=[]};ma.prototype.fromPolygons=function(a){this.clear();for(var b=[],c=[],d=0,e=a.length;d<e;d++){var f=a[d],g=f.edge;do b.push(g),g=g.next;while(g!==f.edge);this.regions.push(f)}a=0;for(d=b.length;a<d;a++)if(e=b[a],null===e.twin)for(f=a+1,g=b.length;f<g;f++){var k=b[f];if(e.tail().equals(k.head())&&e.head().equals(k.tail())){e.linkOpponent(k);f=e.squaredLength();
c.push({cost:f,edge:e});break}}c.sort(w);this._buildRegions(c);this._buildGraph();return this};ma.prototype.clear=function(){this.graph.clear();this.regions.length=0;this.spatialIndex=null;return this};ma.prototype.getClosestRegion=function(a){for(var b=this.regions,c=null,d=Infinity,e=0,f=b.length;e<f;e++){var g=b[e],k=a.squaredDistanceTo(g.centroid);k<d&&(d=k,c=g)}return c};ma.prototype.getRandomRegion=function(){var a=this.regions,b=Math.floor(Math.random()*a.length);b===a.length&&(b=a.length-
1);return a[b]};ma.prototype.getRegionForPoint=function(a,b){b=void 0===b?.001:b;if(null!==this.spatialIndex){var c=this.spatialIndex.getIndexForPosition(a);c=this.spatialIndex.cells[c].entries}else c=this.regions;for(var d=0,e=c.length;d<e;d++){var f=c[d];if(!0===f.contains(a,b))return f}return null};ma.prototype.getNodeIndex=function(a){return this.regions.indexOf(a)};ma.prototype.findPath=function(a,b){var c=this.graph,d=[],e=this.getRegionForPoint(a,this.epsilonContainsTest),f=this.getRegionForPoint(b,
this.epsilonContainsTest);if(null===e||null===f)null===e&&(e=this.getClosestRegion(a)),null===f&&(f=this.getClosestRegion(b));if(e===f)d.push((new l).copy(a)),d.push((new l).copy(b));else if(e=this.getNodeIndex(e),f=this.getNodeIndex(f),c=new Ib(c,e,f),c.search(),!0===c.found){c=c.getPath();f=new Qc;f.push(a,a);a={left:null,right:null};e=0;for(var g=c.length-1;e<g;e++)this._getPortalEdge(this.regions[c[e]],this.regions[c[e+1]],a),f.push(a.left,a.right);f.push(b,b);d.push.apply(d,$jscomp.arrayFromIterable(f.generate()))}return d};
ma.prototype.clampMovement=function(a,b,c,d){var e=this.getRegionForPoint(c,this.epsilonContainsTest);if(null===e){if(null===a)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");this._getClosestBorderEdge(b,Ad);e=Ad.edge;var f=Ad.closestPoint;e.getDirection(xd);c=yd.subVectors(c,b).length();var g=0;0!==c&&(yd.divideScalar(c),g=xd.dot(yd));bc.copy(f).add(xd.multiplyScalar(g*c));cc.set(e.prev.vertex,e.vertex);e=cc.closestPointToPointParameter(bc,!1);if(0<=e&&1>=e)d.copy(bc);else{e=
this.getRegionForPoint(bc,this.epsilonContainsTest);if(null!==e)return d.copy(bc),e;d.copy(b)}return a}return e};ma.prototype.updateSpatialIndex=function(){if(null!==this.spatialIndex){this.spatialIndex.makeEmpty();for(var a=this.regions,b=0,c=a.length;b<c;b++)this.spatialIndex.addPolygon(a[b])}return this};ma.prototype._buildRegions=function(a){var b=this.regions;if(!0===this.mergeConvexRegions)for(var c=0,d=a.length;c<d;c++){var e=a[c],f=e.edge;var g=f.prev;var k=f.next;var m=f.twin.prev;var n=
f.twin.next;f.prev.next=f.twin.next;f.next.prev=f.twin.prev;f.twin.prev.next=f.next;f.twin.next.prev=f.prev;var r=f.polygon;r.edge=f.prev;if(!0===r.convex()&&!0===r.coplanar(this.epsilonCoplanarTest)){g=r.edge;do g.polygon=r,g=g.next;while(g!==r.edge);e=b.indexOf(e.edge.twin.polygon);b.splice(e,1)}else g.next=f,k.prev=f,m.next=f.twin,n.prev=f.twin,r.edge=f}a=0;for(c=b.length;a<c;a++){d=b[a];d.computeCentroid();e=d.edge;do null===e.twin&&this._borderEdges.push(e),e=e.next;while(e!==d.edge)}};ma.prototype._buildGraph=
function(){for(var a=this.graph,b=this.regions,c=[],d=0,e=b.length;d<e;d++){var f=b[d],g=[];c.push(g);var k=f.edge;do{if(null!==k.twin){var m=this.getNodeIndex(k.twin.polygon);g.push(m);!1===a.hasNode(this.getNodeIndex(k.polygon))&&(m=new Pc(this.getNodeIndex(k.polygon),k.polygon.centroid),a.addNode(m))}k=k.next}while(k!==f.edge)}b=0;for(d=c.length;b<d;b++)for(e=c[b],f=b,g=0,k=e.length;g<k;g++)if(m=e[g],f!==m&&!1===a.hasEdge(f,m)){var n=a.getNode(f),r=a.getNode(m);n=n.position.distanceTo(r.position);
a.addEdge(new Oc(f,m,n))}return this};ma.prototype._getClosestBorderEdge=function(a,b){var c=Infinity;if(null!==this.spatialIndex){zd.length=0;var d=this.spatialIndex.getIndexForPosition(a);d=this.spatialIndex.cells[d].entries;for(var e=0,f=d.length;e<f;e++){var g=d[e],k=g.edge;do null===k.twin&&zd.push(k),k=k.next;while(k!==g.edge)}d=zd}else d=this._borderEdges;e=0;for(f=d.length;e<f;e++)g=d[e],cc.set(g.prev.vertex,g.vertex),k=cc.closestPointToPointParameter(a),cc.at(k,wd),k=wd.squaredDistanceTo(a),
k<c&&(c=k,b.edge=g,b.closestPoint.copy(wd));return this};ma.prototype._getPortalEdge=function(a,b,c){var d=a.edge;do{if(null!==d.twin&&d.twin.polygon===b)return c.left=d.prev.vertex,c.right=d.vertex,c;d=d.next}while(d!==a.edge);c.left=null;c.right=null;return c};var Bd=function(){};Bd.prototype.load=function(a,b){var c=this;return new Promise(function(d,e){fetch(a).then(function(f){if(200<=f.status&&300>f.status)return f.arrayBuffer();var g=Error(f.statusText||f.status);g.response=f;return Promise.reject(g)}).then(function(f){return c.parse(f,
a,b)}).then(function(f){d(f)}).catch(function(f){E.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",f);e(f)})})};Bd.prototype.parse=function(a,b,c){var d=new Ma,e=new TextDecoder;"glTF"===e.decode(new Uint8Array(a,0,4))?(d.parseBinary(a),a=d.extensions.get("BINARY").content):a=e.decode(new Uint8Array(a));a=JSON.parse(a);if(void 0===a.asset||2>a.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");b=void 0===b?"":b;e=b.lastIndexOf("/");b=-1===e?"./":b.substr(0,
e+1);return d.parse(a,b,c)};var Ma=function(){this.path=this.json=null;this.cache=new Map;this.extensions=new Map};Ma.prototype.parse=function(a,b,c){var d=this;this.json=a;this.path=b;return this.getDependency("mesh",0).then(function(e){e=d.parseGeometry(e);var f=new ma;c&&(void 0!==c.epsilonCoplanarTest&&(f.epsilonCoplanarTest=c.epsilonCoplanarTest),void 0!==c.mergeConvexRegions&&(f.mergeConvexRegions=c.mergeConvexRegions));return f.fromPolygons(e)})};Ma.prototype.parseGeometry=function(a){var b=
a.index,c=a.position;a=[];for(var d=[],e=0,f=c.length;e<f;e+=3){var g=new l;g.x=c[e+0];g.y=c[e+1];g.z=c[e+2];a.push(g)}if(b)for(c=0,e=b.length;c<e;c+=3)f=[a[b[c+0]],a[b[c+1]],a[b[c+2]]],f=(new ha).fromContour(f),d.push(f);else for(b=0,c=a.length;b<c;b+=3)e=[a[b+0],a[b+1],a[b+2]],e=(new ha).fromContour(e),d.push(e);return d};Ma.prototype.getDependencies=function(a){var b=this,c=this.cache,d=c.get(a);d||(d=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(e,f){return b.getDependency(a,
f)})),c.set(a,d));return d};Ma.prototype.getDependency=function(a,b){var c=this.cache,d=a+":"+b,e=c.get(d);if(void 0===e){switch(a){case "accessor":e=this.loadAccessor(b);break;case "buffer":e=this.loadBuffer(b);break;case "bufferView":e=this.loadBufferView(b);break;case "mesh":e=this.loadMesh(b);break;default:throw Error("Unknown type: "+a);}c.set(d,e)}return e};Ma.prototype.loadBuffer=function(a){var b=this,c=this.json.buffers[a];return void 0===c.uri&&0===a?Promise.resolve(this.extensions.get("BINARY").body):
new Promise(function(d,e){var f=x(c.uri,b.path);fetch(f).then(function(g){return g.arrayBuffer()}).then(function(g){d(g)}).catch(function(g){E.error("YUKA.NavMeshLoader: Unable to load buffer.",g);e(g)})})};Ma.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(c){var d=b.byteOffset||0;return c.slice(d,d+(b.byteLength||0))})};Ma.prototype.loadAccessor=function(a){var b=this.json.accessors[a];return this.getDependency("bufferView",
b.bufferView).then(function(c){return new Ne[b.componentType](c,b.byteOffset||0,b.count*Oe[b.type])})};Ma.prototype.loadMesh=function(a){var b=this.json.meshes[a];return this.getDependencies("accessor").then(function(c){var d=b.primitives[0];if(void 0!==d.mode&&4!==d.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");return{index:c[d.indices],position:c[d.attributes.POSITION],normal:c[d.attributes.NORMAL]}})};Ma.prototype.parseBinary=
function(a){for(var b=new DataView(a,12),c=0,d=new TextDecoder,e=null,f=null;c<b.byteLength;){var g=b.getUint32(c,!0);c+=4;var k=b.getUint32(c,!0);c+=4;k===ye.JSON?(e=new Uint8Array(a,12+c,g),e=d.decode(e)):k===ye.BIN&&(f=12+c,f=a.slice(f,f+g));c+=g}this.extensions.set("BINARY",{content:e,body:f})};var Oe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ne={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ye={JSON:1313821514,BIN:5130562},Ga=
function(a){this.aabb=a=void 0===a?new S:a;this.entries=[]};Ga.prototype.add=function(a){this.entries.push(a);return this};Ga.prototype.remove=function(a){a=this.entries.indexOf(a);this.entries.splice(a,1);return this};Ga.prototype.makeEmpty=function(){this.entries.length=0;return this};Ga.prototype.empty=function(){return 0===this.entries.length};Ga.prototype.intersects=function(a){return this.aabb.intersectsAABB(a)};Ga.prototype.toJSON=function(){for(var a={type:this.constructor.name,aabb:this.aabb.toJSON(),
entries:[]},b=this.entries,c=0,d=b.length;c<d;c++)a.entries.push(b[c].uuid);return a};Ga.prototype.fromJSON=function(a){this.aabb.fromJSON(a.aabb);this.entries=a.entries.slice();return this};Ga.prototype.resolveReferences=function(a){for(var b=this.entries,c=0,d=b.length;c<d;c++)b[c]=a.get(b[c]);return this};var Rc=new l,dc=new S,ze=[],Ha=function(a,b,c,d,e,f){this.cells=[];this.width=a;this.height=b;this.depth=c;this.cellsX=d;this.cellsY=e;this.cellsZ=f;this._halfWidth=this.width/2;this._halfHeight=
this.height/2;this._halfDepth=this.depth/2;this._min=new l(-this._halfWidth,-this._halfHeight,-this._halfDepth);this._max=new l(this._halfWidth,this._halfHeight,this._halfDepth);a=this.width/this.cellsX;b=this.height/this.cellsY;c=this.depth/this.cellsZ;for(d=0;d<this.cellsX;d++)for(e=d*a-this._halfWidth,f=0;f<this.cellsY;f++)for(var g=f*b-this._halfHeight,k=0;k<this.cellsZ;k++){var m=k*c-this._halfDepth,n=new l,r=new l;n.set(e,g,m);r.x=n.x+a;r.y=n.y+b;r.z=n.z+c;m=new S(n,r);m=new Ga(m);this.cells.push(m)}};
Ha.prototype.updateEntity=function(a,b){b=void 0===b?-1:b;var c=this.getIndexForPosition(a.position);b!==c&&(this.addEntityToPartition(a,c),-1!==b&&this.removeEntityFromPartition(a,b));return c};Ha.prototype.addEntityToPartition=function(a,b){this.cells[b].add(a);return this};Ha.prototype.removeEntityFromPartition=function(a,b){this.cells[b].remove(a);return this};Ha.prototype.getIndexForPosition=function(a){Rc.copy(a).clamp(this._min,this._max);a=Math.abs(Math.floor(this.cellsX*(Rc.x+this._halfWidth)/
this.width));var b=Math.abs(Math.floor(this.cellsY*(Rc.y+this._halfHeight)/this.height)),c=Math.abs(Math.floor(this.cellsZ*(Rc.z+this._halfDepth)/this.depth));a===this.cellsX&&(a=this.cellsX-1);b===this.cellsY&&(b=this.cellsY-1);c===this.cellsZ&&(c=this.cellsZ-1);return a*this.cellsY*this.cellsZ+b*this.cellsZ+c};Ha.prototype.query=function(a,b,c){var d=this.cells;c.length=0;dc.min.copy(a).subScalar(b);dc.max.copy(a).addScalar(b);a=0;for(b=d.length;a<b;a++){var e=d[a];!1===e.empty()&&!0===e.intersects(dc)&&
c.push.apply(c,$jscomp.arrayFromIterable(e.entries))}return c};Ha.prototype.makeEmpty=function(){for(var a=this.cells,b=0,c=a.length;b<c;b++)a[b].makeEmpty();return this};Ha.prototype.addPolygon=function(a){var b=this.cells;a.getContour(ze);dc.fromPoints(ze);for(var c=0,d=b.length;c<d;c++){var e=b[c];!0===e.intersects(dc)&&e.add(a)}return this};Ha.prototype.toJSON=function(){for(var a={type:this.constructor.name,cells:[],width:this.width,height:this.height,depth:this.depth,cellsX:this.cellsX,cellsY:this.cellsY,
cellsZ:this.cellsZ,_halfWidth:this._halfWidth,_halfHeight:this._halfHeight,_halfDepth:this._halfDepth,_min:this._min.toArray([]),_max:this._max.toArray([])},b=0,c=this.cells.length;b<c;b++)a.cells.push(this.cells[b].toJSON());return a};Ha.prototype.fromJSON=function(a){this.cells.length=0;this.width=a.width;this.height=a.height;this.depth=a.depth;this.cellsX=a.cellsX;this.cellsY=a.cellsY;this.cellsZ=a.cellsZ;this._halfWidth=a._halfWidth;this._halfDepth=this._halfHeight=a._halfHeight;this._min.fromArray(a._min);
this._max.fromArray(a._max);for(var b=0,c=a.cells.length;b<c;b++)this.cells.push((new Ga).fromJSON(a.cells[b]));return this};Ha.prototype.resolveReferences=function(a){for(var b=0,c=this.cells.length;b<c;b++)this.cells[b].resolveReferences(a);return this};var Mb=function(a){this.entity=void 0===a?null:a;this.timeLastSensed=this.timeBecameVisible=-Infinity;this.lastSensedPosition=new l;this.visible=!1};Mb.prototype.toJSON=function(){return{type:this.constructor.name,entity:this.entity.uuid,timeBecameVisible:this.timeBecameVisible.toString(),
timeLastSensed:this.timeLastSensed.toString(),lastSensedPosition:this.lastSensedPosition.toArray([]),visible:this.visible}};Mb.prototype.fromJSON=function(a){this.entity=a.entity;this.timeBecameVisible=parseFloat(a.timeBecameVisible);this.timeLastSensed=parseFloat(a.timeLastSensed);this.lastSensedPosition.fromArray(a.lastSensedPosition);this.visible=a.visible;return this};Mb.prototype.resolveReferences=function(a){this.entity=a.get(this.entity)||null;return this};var Na=function(a){this.owner=void 0===
a?null:a;this.records=[];this.recordsMap=new Map;this.memorySpan=1};Na.prototype.getRecord=function(a){return this.recordsMap.get(a)};Na.prototype.createRecord=function(a){var b=new Mb(a);this.records.push(b);this.recordsMap.set(a,b);return this};Na.prototype.deleteRecord=function(a){var b=this.getRecord(a);b=this.records.indexOf(b);this.records.splice(b,1);this.recordsMap.delete(a);return this};Na.prototype.hasRecord=function(a){return this.recordsMap.has(a)};Na.prototype.clear=function(){this.records.length=
0;this.recordsMap.clear();return this};Na.prototype.getValidMemoryRecords=function(a,b){for(var c=this.records,d=b.length=0,e=c.length;d<e;d++){var f=c[d];a-f.timeLastSensed<=this.memorySpan&&b.push(f)}return b};Na.prototype.toJSON=function(){for(var a={type:this.constructor.name,owner:this.owner.uuid,records:[],memorySpan:this.memorySpan},b=this.records,c=0,d=b.length;c<d;c++)a.records.push(b[c].toJSON());return a};Na.prototype.fromJSON=function(a){this.owner=a.owner;this.memorySpan=a.memorySpan;
a=a.records;for(var b=0,c=a.length;b<c;b++){var d=a[b];d=(new Mb).fromJSON(d);this.records.push(d)}return this};Na.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=this.records,c=0,d=b.length;c<d;c++){var e=b[c];e.resolveReferences(a);this.recordsMap.set(e.entity,e)}return this};var Sc=new l,Ae=new l,Cd=new Y,Be=new l,Tc=new l,qb=function(a){this.owner=void 0===a?null:a;this.fieldOfView=Math.PI;this.range=Infinity;this.obstacles=[]};qb.prototype.addObstacle=function(a){this.obstacles.push(a);
return this};qb.prototype.removeObstacle=function(a){a=this.obstacles.indexOf(a);this.obstacles.splice(a,1);return this};qb.prototype.visible=function(a){var b=this.owner,c=this.obstacles;b.getWorldPosition(Tc);Sc.subVectors(a,Tc);a=Sc.length();if(a>this.range)return!1;b.getWorldDirection(Ae);if(Ae.angleTo(Sc)>.5*this.fieldOfView)return!1;Cd.origin.copy(Tc);Cd.direction.copy(Sc).divideScalar(a||1);b=0;for(var d=c.length;b<d;b++)if(null!==c[b].lineOfSightTest(Cd,Be)&&Be.squaredDistanceTo(Tc)<=a*a)return!1;
return!0};qb.prototype.toJSON=function(){for(var a={type:this.constructor.name,owner:this.owner.uuid,fieldOfView:this.fieldOfView,range:this.range.toString(),obstacles:[]},b=0,c=this.obstacles.length;b<c;b++)a.obstacles.push(this.obstacles[b].uuid);return a};qb.prototype.fromJSON=function(a){this.owner=a.owner;this.fieldOfView=a.fieldOfView;this.range=parseFloat(a.range);for(var b=0,c=a.obstacles.length;b<c;b++)this.obstacles.push(a.obstacles[b]);return this};qb.prototype.resolveReferences=function(a){this.owner=
a.get(this.owner)||null;for(var b=this.obstacles,c=0,d=b.length;c<d;c++)b[c]=a.get(b[c]);return this};var Ce=new l,Dd=new l,Ed=new l,Fd=new Ba,De=new l,ec=function(a,b,c){a=void 0===a?new Ja:a;b=void 0===b?.1:b;c=void 0===c?1:c;var d=A.call(this)||this;d.path=a;d.radius=b;d.predictionFactor=c;d._seek=new Ia;return d};$jscomp.inherits(ec,A);ec.prototype.calculate=function(a,b){var c=this.path;Ce.copy(a.velocity).multiplyScalar(this.predictionFactor);Dd.addVectors(a.position,Ce);var d=Infinity,e=c._waypoints.length;
e=!0===c.loop?e:e-1;for(var f=0;f<e;f++){Fd.from=c._waypoints[f];Fd.to=!0===c.loop&&f===e-1?c._waypoints[0]:c._waypoints[f+1];Fd.closestPointToPoint(Dd,!0,Ed);var g=Dd.squaredDistanceTo(Ed);g<d&&(d=g,De.copy(Ed))}d>this.radius*this.radius&&1<c._waypoints.length&&(this._seek.target=De,this._seek.calculate(a,b));return b};ec.prototype.toJSON=function(){var a=A.prototype.toJSON.call(this);a.path=this.path.toJSON();a.radius=this.radius;a.predictionFactor=this.predictionFactor;return a};ec.prototype.fromJSON=
function(a){A.prototype.fromJSON.call(this,a);this.path.fromJSON(a.path);this.radius=a.radius;this.predictionFactor=a.predictionFactor;return this};var Ee=function(){};Ee.prototype.execute=function(){};var Gd=function(){this.tasks=[];this.options={timeout:1E3};this._active=!1;this._handler=y.bind(this);this._taskHandle=0};Gd.prototype.enqueue=function(a){this.tasks.push(a);return this};Gd.prototype.update=function(){0<this.tasks.length?!1===this._active&&(this._taskHandle=requestIdleCallback(this._handler,
this.options),this._active=!0):this._active=!1;return this};h.AABB=S;h.AStar=Ib;h.AlignmentBehavior=vc;h.ArriveBehavior=Oa;h.BFS=Yb;h.BVH=rd;h.BVHNode=xa;h.BoundingSphere=ca;h.CHFace=Da;h.CHVertex=se;h.CHVertexList=Ca;h.Cell=Ga;h.CellSpacePartitioning=Ha;h.CohesionBehavior=xc;h.CompositeGoal=la;h.ConvexHull=Z;h.Corridor=Qc;h.CostTable=$a;h.DFS=Zb;h.Dijkstra=$b;h.Edge=La;h.EntityManager=wa;h.EvadeBehavior=db;h.EventDispatcher=Ub;h.FleeBehavior=cb;h.FollowPathBehavior=tb;h.FuzzyAND=Ic;h.FuzzyCompositeTerm=
ka;h.FuzzyFAIRLY=zb;h.FuzzyModule=qa;h.FuzzyOR=Jc;h.FuzzyRule=Gb;h.FuzzySet=L;h.FuzzyTerm=Ra;h.FuzzyVERY=Ab;h.FuzzyVariable=Sa;h.GameEntity=P;h.Goal=N;h.GoalEvaluator=Xb;h.Graph=fa;h.GraphUtils=xe;h.HalfEdge=Ya;h.HeuristicPolicyDijkstra=ke;h.HeuristicPolicyEuclid=qd;h.HeuristicPolicyEuclidSquared=ie;h.HeuristicPolicyManhattan=je;h.InterposeBehavior=eb;h.LeftSCurveFuzzySet=Vb;h.LeftShoulderFuzzySet=Bb;h.LineSegment=Ba;h.Logger=E;h.MathUtils=T;h.Matrix3=O;h.Matrix4=R;h.MemoryRecord=Mb;h.MemorySystem=
Na;h.MeshGeometry=lb;h.MessageDispatcher=ra;h.MovingEntity=ta;h.NavEdge=Oc;h.NavMesh=ma;h.NavMeshLoader=Bd;h.NavNode=Pc;h.Node=Hb;h.NormalDistFuzzySet=Cb;h.OBB=ia;h.ObstacleAvoidanceBehavior=fb;h.OffsetPursuitBehavior=gb;h.OnPathBehavior=ec;h.Path=Ja;h.Plane=na;h.Polygon=ha;h.Polyhedron=Za;h.PriorityQueue=Va;h.PursuitBehavior=hb;h.Quaternion=Q;h.Ray=Y;h.RectangularTriggerRegion=jb;h.Regulator=he;h.RightSCurveFuzzySet=Wb;h.RightShoulderFuzzySet=Db;h.SAT=Xa;h.SeekBehavior=Ia;h.SeparationBehavior=Ec;
h.SingletonFuzzySet=Eb;h.Smoother=Sb;h.SphericalTriggerRegion=kb;h.State=Qa;h.StateMachine=pa;h.SteeringBehavior=A;h.SteeringManager=ua;h.Task=Ee;h.TaskQueue=Gd;h.Telegram=H;h.Think=Fa;h.Time=oa;h.TriangularFuzzySet=Fb;h.Trigger=Ka;h.TriggerRegion=va;h.Vector3=l;h.Vehicle=ib;h.Vision=qb;h.WanderBehavior=vb;h.WorldUp=Uc;Object.defineProperty(h,"__esModule",{value:!0})});
